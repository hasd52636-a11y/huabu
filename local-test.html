<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬åœ°æµ‹è¯• - æ›¹æ“ç”»å¸ƒ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .url {
            background: #f1f3f4;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            word-break: break-all;
            margin: 10px 0;
        }
        #testResults {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸ¨ æ›¹æ“ç”»å¸ƒæœ¬åœ°æµ‹è¯•</h1>
    
    <div class="test-section success">
        <h3>âœ… æœåŠ¡å™¨çŠ¶æ€</h3>
        <p>å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œåœ¨ç«¯å£ 3005</p>
        <div class="url">http://localhost:3005</div>
    </div>

    <div class="test-section">
        <h3>ğŸ”§ æµ‹è¯•æ­¥éª¤</h3>
        <ol>
            <li><button onclick="testMainApp()">æµ‹è¯•ä¸»åº”ç”¨</button> - æ£€æŸ¥åº”ç”¨æ˜¯å¦èƒ½æ­£å¸¸åŠ è½½</li>
            <li><button onclick="testBasicFeatures()">æµ‹è¯•åŸºç¡€åŠŸèƒ½</button> - æ£€æŸ¥åŸºæœ¬åŠŸèƒ½</li>
            <li><button onclick="testSharingFeature()">æµ‹è¯•åŒå±åˆ†äº«</button> - åˆ›å»ºæµ‹è¯•åˆ†äº«</li>
            <li><button onclick="testViewerMode()">æµ‹è¯•è§‚çœ‹æ¨¡å¼</button> - æ‰“å¼€è§‚çœ‹é¡µé¢</li>
        </ol>
    </div>

    <div id="testResults"></div>

    <script>
        const serverUrl = 'http://localhost:3005';
        
        function showResult(title, message, type = 'info') {
            const results = document.getElementById('testResults');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'test-section';
            results.innerHTML += `
                <div class="${className}">
                    <h4>${title}</h4>
                    <p>${message}</p>
                </div>
            `;
        }

        function testMainApp() {
            showResult('ğŸŒ æµ‹è¯•ä¸»åº”ç”¨', 'æ­£åœ¨æ‰“å¼€ä¸»åº”ç”¨...');
            
            // æ‰“å¼€ä¸»åº”ç”¨
            const mainWindow = window.open(serverUrl, '_blank');
            
            setTimeout(() => {
                if (mainWindow && !mainWindow.closed) {
                    showResult('âœ… ä¸»åº”ç”¨æµ‹è¯•', 'ä¸»åº”ç”¨å·²åœ¨æ–°çª—å£ä¸­æ‰“å¼€ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æ­£å¸¸æ˜¾ç¤º', 'success');
                } else {
                    showResult('âŒ ä¸»åº”ç”¨æµ‹è¯•', 'æ— æ³•æ‰“å¼€ä¸»åº”ç”¨ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ', 'error');
                }
            }, 1000);
        }

        function testBasicFeatures() {
            showResult('ğŸ”§ åŸºç¡€åŠŸèƒ½æµ‹è¯•', 'è¯·åœ¨ä¸»åº”ç”¨ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<br>1. ç‚¹å‡»å·¦ä¾§å·¥å…·æ æ·»åŠ æ–‡æœ¬æ¨¡å—<br>2. ç‚¹å‡»å·¦ä¾§å·¥å…·æ æ·»åŠ å›¾ç‰‡æ¨¡å—<br>3. æ£€æŸ¥æ¨¡å—æ˜¯å¦æ­£å¸¸æ˜¾ç¤º');
        }

        function testSharingFeature() {
            // åˆ›å»ºæµ‹è¯•åˆ†äº«æ•°æ®
            const testShareId = 'test-' + Date.now();
            const testData = {
                shareId: testShareId,
                timestamp: Date.now(),
                canvasState: {
                    blocks: [
                        {
                            id: 'test-block-1',
                            type: 'text',
                            x: 100,
                            y: 100,
                            width: 300,
                            height: 150,
                            content: 'ğŸ‰ åŒå±åˆ†äº«æµ‹è¯•æˆåŠŸï¼\\n\\nè¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡æœ¬æ¨¡å—\\nåˆ›å»ºæ—¶é—´: ' + new Date().toLocaleString(),
                            status: 'idle',
                            number: 'A01'
                        },
                        {
                            id: 'test-block-2',
                            type: 'text',
                            x: 450,
                            y: 100,
                            width: 350,
                            height: 120,
                            content: 'âœ… å¦‚æœä½ èƒ½çœ‹åˆ°è¿™ä¸ªå†…å®¹ï¼Œè¯´æ˜åŒå±åˆ†äº«åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼',
                            status: 'idle',
                            number: 'A02'
                        }
                    ],
                    connections: [],
                    zoom: 1,
                    pan: { x: 0, y: 0 }
                },
                status: 'active',
                message: 'æµ‹è¯•åˆ†äº«å·²åˆ›å»º',
                lastUpdate: Date.now()
            };

            localStorage.setItem(\`canvas-share-\${testShareId}\`, JSON.stringify(testData));
            
            const shareUrl = \`\${serverUrl}?watch=\${testShareId}\`;
            
            showResult('âœ… åˆ†äº«åŠŸèƒ½æµ‹è¯•', \`æµ‹è¯•åˆ†äº«å·²åˆ›å»º<br>åˆ†äº«ID: \${testShareId}<br>åŒ…å« \${testData.canvasState.blocks.length} ä¸ªæ¨¡å—<br><div class="url">\${shareUrl}</div><button onclick="window.open('\${shareUrl}', '_blank')">æ‰“å¼€æµ‹è¯•åˆ†äº«</button>\`, 'success');
        }

        function testViewerMode() {
            // æŸ¥æ‰¾æœ€æ–°çš„æµ‹è¯•åˆ†äº«
            const keys = Object.keys(localStorage).filter(key => key.startsWith('canvas-share-'));
            if (keys.length === 0) {
                showResult('âš ï¸ è§‚çœ‹æ¨¡å¼æµ‹è¯•', 'è¯·å…ˆåˆ›å»ºæµ‹è¯•åˆ†äº«', 'error');
                return;
            }

            const latestKey = keys.sort().pop();
            const shareId = latestKey.replace('canvas-share-', '');
            const viewerUrl = \`\${serverUrl}?watch=\${shareId}\`;
            
            showResult('ğŸ” è§‚çœ‹æ¨¡å¼æµ‹è¯•', \`æ­£åœ¨æ‰“å¼€è§‚çœ‹æ¨¡å¼...<br><div class="url">\${viewerUrl}</div>\`);
            
            window.open(viewerUrl, '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰çŠ¶æ€
        window.onload = function() {
            const shareCount = Object.keys(localStorage).filter(key => key.startsWith('canvas-share-')).length;
            if (shareCount > 0) {
                showResult('ğŸ“Š å½“å‰çŠ¶æ€', \`å‘ç° \${shareCount} ä¸ªåˆ†äº«è®°å½•\`);
            }
            
            // æ£€æŸ¥æœåŠ¡å™¨è¿æ¥
            fetch(serverUrl)
                .then(response => {
                    if (response.ok) {
                        showResult('ğŸŒ æœåŠ¡å™¨è¿æ¥', 'æœåŠ¡å™¨è¿æ¥æ­£å¸¸', 'success');
                    } else {
                        showResult('âš ï¸ æœåŠ¡å™¨è¿æ¥', 'æœåŠ¡å™¨å“åº”å¼‚å¸¸', 'error');
                    }
                })
                .catch(error => {
                    showResult('âŒ æœåŠ¡å™¨è¿æ¥', 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨: ' + error.message, 'error');
                });
        };
    </script>
</body>
</html>