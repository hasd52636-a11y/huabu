# Implementation Tasks: Sidebar Model Selectors

## Task Overview

基于四个核心原则实现侧边栏模型选择器：
1. 右侧侧边栏模型选择
2. 功能智能匹配
3. 基于现有模型
4. 简单配置

## Task List

### Phase 1: 核心组件扩展

- [x] 1.1 扩展 ModelSelector 组件支持图像和视频类型
  - [x] 1.1.1 添加 generationType 参数支持 'image' | 'video'
  - [x] 1.1.2 基于类型过滤显示对应模型列表
  - [x] 1.1.3 添加模型锁定状态显示（disabled + lockReason）
  - [x] 1.1.4 保持现有文本模型选择器功能不变

- [x] 1.2 创建简化的功能模型管理器
  - [x] 1.2.1 实现 FeatureModelManager 类
  - [x] 1.2.2 硬编码功能-模型绑定关系
  - [x] 1.2.3 提供 getRequiredModel() 方法
  - [x] 1.2.4 提供 shouldLockModel() 检查方法
  - [x] 1.2.5 提供 getLockReason() 友好提示方法

### Phase 2: 模型配置和数据

- [x] 2.1 定义现有模型列表常量
  - [x] 2.1.1 创建 IMAGE_MODELS 分类常量（basic, advanced, editing）
  - [x] 2.1.2 创建 VIDEO_MODELS 分类常量（sora, veo, wanx, special）
  - [x] 2.1.3 创建 FEATURE_BINDINGS 硬编码绑定

- [x] 2.2 实现用户偏好存储
  - [x] 2.2.1 扩展 types.ts 添加图像视频偏好接口
  - [x] 2.2.2 实现 localStorage 存储逻辑
  - [x] 2.2.3 添加默认值降级机制
  - [x] 2.2.4 保持与现有文本偏好的兼容性

### Phase 3: 侧边栏集成

- [x] 3.1 在侧边栏添加图像模型选择器
  - [x] 3.1.1 找到侧边栏组件位置
  - [x] 3.1.2 添加图像 ModelSelector 实例
  - [x] 3.1.3 连接用户偏好存储
  - [x] 3.1.4 添加适当的样式和布局

- [x] 3.2 在侧边栏添加视频模型选择器
  - [x] 3.2.1 添加视频 ModelSelector 实例
  - [x] 3.2.2 连接用户偏好存储
  - [x] 3.2.3 确保与图像选择器布局一致

### Phase 4: 智能路由集成

- [x] 4.1 扩展 SmartRoutingService 支持图像视频
  - [x] 4.1.1 添加图像内容分析逻辑
  - [x] 4.1.2 添加视频内容分析逻辑
  - [x] 4.1.3 集成 FeatureModelManager 进行功能检测
  - [x] 4.1.4 保持现有文本路由逻辑不变

- [x] 4.2 实现画布功能模型锁定
  - [x] 4.2.1 在画布功能中集成 FeatureModelManager
  - [x] 4.2.2 显示模型锁定提示 UI
  - [x] 4.2.3 确保功能使用正确的绑定模型

### Phase 5: 测试实现

- [x] 5.1 编写单元测试
  - [x] 5.1.1 测试 ModelSelector 组件的图像视频支持
  - [x] 5.1.2 测试 FeatureModelManager 的绑定逻辑
  - [x] 5.1.3 测试用户偏好存储和恢复
  - [x] 5.1.4 测试向后兼容性（现有文本功能）

- [x] 5.2 编写属性测试
  - [x] 5.2.1 Property 1: 侧边栏模型选择持久化
  - [x] 5.2.2 Property 2: 功能智能匹配
  - [x] 5.2.3 Property 3: 基础生成偏好尊重
  - [x] 5.2.4 Property 4: 友好提醒显示
  - [x] 5.2.5 Property 5: 向后兼容性

### Phase 6: 错误处理和优化

- [ ] 6.1 实现错误处理
  - [ ] 6.1.1 模型不可用时的降级逻辑
  - [ ] 6.1.2 存储失败时的会话降级
  - [ ] 6.1.3 功能冲突时的友好提示

- [ ] 6.2 性能优化
  - [ ] 6.2.1 模型列表懒加载（如果需要）
  - [ ] 6.2.2 用户偏好缓存优化
  - [ ] 6.2.3 组件渲染优化

## Implementation Notes

### 关键设计决策
- **复用现有**: 扩展现有 ModelSelector 而不是重写
- **简单配置**: 使用硬编码常量而不是复杂配置文件
- **向后兼容**: 确保现有文本聊天功能不受影响
- **渐进增强**: 分阶段实现，每个阶段都可独立测试

### 技术约束
- 基于现有模型列表，不添加新的 API 配置
- 使用现有的路由和参数逻辑
- 保持 UI 一致性和用户体验

### 测试策略
- 单元测试覆盖具体场景和边界情况
- 属性测试验证通用行为
- 集成测试确保与现有系统的兼容性

## Success Criteria

- [ ] 用户可以在侧边栏选择默认的图像和视频模型
- [ ] 画布功能自动使用正确的模型，不受用户偏好影响
- [ ] 模型锁定时显示清晰的友好提示
- [ ] 现有文本聊天功能继续正常工作
- [ ] 所有测试通过，包括属性测试