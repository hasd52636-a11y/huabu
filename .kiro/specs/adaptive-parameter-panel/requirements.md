# Requirements Document: Adaptive Parameter Panel

## Overview

创建一个智能的自适应参数配置面板系统，根据不同模型的参数复杂度自动选择最合适的UI展示方式，解决当前小按钮区域无法容纳复杂参数配置的问题。

## User Stories

### 需求 1: 模型复杂度分级

**用户故事:** 作为用户，我希望系统能够根据不同模型的参数复杂度自动选择合适的界面展示方式，这样我可以在简单模型时保持简洁，在复杂模型时获得完整的参数控制。

#### 验收标准

1. WHEN 用户选择简单模型（如基础文本生成）THEN 系统 SHALL 保持当前的小按钮界面
2. WHEN 用户选择中等复杂度模型（如图像生成）THEN 系统 SHALL 展开为紧凑的参数条
3. WHEN 用户选择复杂模型（如多图生视频、角色替换）THEN 系统 SHALL 弹出专门的参数面板
4. WHEN 模型复杂度改变 THEN 系统 SHALL 自动切换到对应的界面模式
5. WHEN 界面模式切换 THEN 系统 SHALL 保持所有已配置参数的状态

### 需求 2: 模型参数分类管理

**用户故事:** 作为用户，我希望不同类型的模型能够展示对应的参数选项，这样我可以根据模型特性进行精确配置。

#### 验收标准

1. WHEN 用户选择文本模型 THEN 系统 SHALL 显示文本相关参数（温度、最大长度、思维链等）
2. WHEN 用户选择基础图像模型 THEN 系统 SHALL 显示基础参数（宽高比、尺寸、风格）
3. WHEN 用户选择高级图像模型 THEN 系统 SHALL 显示高级参数（参考图、多图输入、编辑模式）
4. WHEN 用户选择基础视频模型 THEN 系统 SHALL 显示基础参数（宽高比、时长、质量）
5. WHEN 用户选择高级视频模型 THEN 系统 SHALL 显示高级参数（角色替换、风格转换、多图生视频）

### 需求 3: 统一参数面板设计

**用户故事:** 作为用户，我希望有一个统一的参数配置面板，通过标签页集中管理图像和视频的所有参数，这样我可以在一个界面中完成所有配置而不需要在多个小按钮间切换。

#### 验收标准

1. WHEN 用户点击参数配置按钮 THEN 系统 SHALL 弹出统一的参数配置面板
2. WHEN 参数面板打开 THEN 系统 SHALL 显示图像、视频、文本三个主要标签页
3. WHEN 用户切换标签页 THEN 系统 SHALL 显示对应类型的所有相关参数
4. WHEN 用户在标签页间切换 THEN 系统 SHALL 保持各标签页的参数状态
5. WHEN 面板空间充足 THEN 系统 SHALL 提供参数的实时预览和说明

### 需求 4: 参数预设管理

**用户故事:** 作为用户，我希望能够保存和管理常用的参数配置，这样我可以快速重用之前的设置。

#### 验收标准

1. WHEN 用户配置参数后 THEN 系统 SHALL 提供保存预设的选项
2. WHEN 用户保存预设 THEN 系统 SHALL 允许为预设命名并分类
3. WHEN 用户选择预设 THEN 系统 SHALL 自动应用所有相关参数
4. WHEN 用户修改预设参数 THEN 系统 SHALL 提示是否更新原预设或创建新预设
5. WHEN 用户删除预设 THEN 系统 SHALL 要求确认并提供撤销选项

## Interface Design Strategy

### 主要设计原则
1. **统一弹窗面板**: 使用模态框提供足够的配置空间
2. **标签页分类**: 按生成类型（图像/视频/文本）组织参数
3. **渐进式展示**: 根据模型复杂度显示对应的参数选项
4. **智能默认值**: 为不同模型提供合理的默认参数配置

### 弹窗面板布局

#### 面板尺寸
- **桌面端**: 800x600px，居中显示
- **移动端**: 全屏模式，适配小屏幕
- **最小尺寸**: 600x400px

#### 标签页结构
```
┌─────────────────────────────────────────┐
│  🖼️ 图像生成  │  🎬 视频生成  │  📝 文本生成  │
├─────────────────────────────────────────┤
│                                         │
│  [当前标签页的参数配置区域]                │
│                                         │
│  ┌─────────────┐  ┌─────────────┐      │
│  │  基础参数    │  │  高级参数    │      │
│  └─────────────┘  └─────────────┘      │
│                                         │
│  [预设管理区域]                          │
│                                         │
├─────────────────────────────────────────┤
│           [取消]    [应用]    [保存预设]   │
└─────────────────────────────────────────┘
```

## Model Complexity & Parameter Mapping

### 图像生成参数分级

#### 简单图像模型 (nano-banana)
- 宽高比选择
- 基础质量设置

#### 中等图像模型 (nano-banana-hd, flux-kontext)
- 宽高比选择
- 图像尺寸 (1K/2K/4K)
- 风格选择
- 质量设置

#### 复杂图像模型 (byteedit-v2.0, 多图编辑)
- 所有基础参数
- 参考图片上传
- 多图输入管理
- 编辑模式选择
- 蒙版编辑
- 高级参数 (引导强度、步数)

### 视频生成参数分级

#### 简单视频模型 (sora_video2)
- 宽高比选择 (16:9/9:16)
- 时长选择 (10s/15s/25s)
- 高清选项

#### 中等视频模型 (sora-2, veo3)
- 所有基础参数
- 风格选择
- 参考图片
- 质量设置

#### 复杂视频模型 (角色替换, 多图生视频, 风格转换)
- 所有基础参数
- 多文件上传管理
- 角色选择界面
- 风格配置选项
- 高级编辑参数
- 批量处理设置

## Parameter Categories

### 通用参数
- 宽高比 (aspectRatio)
- 质量设置 (quality/hd)
- 模型选择 (model)

### 图像专用参数
- 图像尺寸 (imageSize: 1K/2K/4K)
- 参考图片 (referenceImage)
- 编辑模式 (editMode)
- 多图输入 (multipleImages)

### 视频专用参数  
- 视频时长 (duration: 10s/15s/25s)
- 帧率 (frameRate)
- 角色设置 (character)
- 风格参考 (styleReference)

### 高级参数
- 引导强度 (guidanceScale)
- 步数 (steps)
- 种子值 (seed)
- 批量设置 (batchConfig)

## Interface Modes

### 主要模式: 统一弹窗面板 (Unified Modal Panel)

#### 触发方式
- **简单模型**: 点击DynamicMenu中的"参数"按钮直接弹出面板
- **复杂模型**: 自动检测到复杂参数时提示用户打开面板
- **手动触发**: 用户随时可以通过快捷键或按钮打开面板

#### 面板特性
- **标签页导航**: 图像/视频/文本三个主标签
- **动态参数**: 根据选中的模型显示对应参数
- **实时预览**: 参数变化时提供视觉反馈
- **预设管理**: 内置预设保存和加载功能

#### 标签页内容

##### 🖼️ 图像生成标签
```
基础参数区域:
├── 模型选择 (nano-banana, nano-banana-hd, flux-kontext, etc.)
├── 宽高比选择 (1:1, 4:3, 16:9, 9:16, 自定义)
├── 图像尺寸 (1K, 2K, 4K)
└── 质量设置 (标准, 高清, 超清)

高级参数区域 (根据模型显示):
├── 参考图片上传
├── 多图输入管理
├── 编辑模式 (生成, 编辑, 变换)
├── 风格选择
├── 引导强度 (1-20)
└── 生成步数 (10-50)
```

##### 🎬 视频生成标签  
```
基础参数区域:
├── 模型选择 (sora_video2, sora-2, veo3, etc.)
├── 宽高比选择 (16:9, 9:16)
├── 时长选择 (10s, 15s, 25s)
└── 质量设置 (标准, 高清)

高级参数区域 (根据模型显示):
├── 参考图片/视频上传
├── 角色选择管理
├── 风格配置
├── 多图生视频设置
├── 角色替换选项
└── 批量处理配置
```

##### 📝 文本生成标签
```
基础参数区域:
├── 模型选择 (gemini-3-flash, gpt-4o, etc.)
├── 最大长度 (100-4000字符)
├── 创造性 (保守, 平衡, 创新)
└── 响应格式 (自由, 结构化)

高级参数区域:
├── 思维链推理
├── 联网搜索
├── 代码执行
├── 温度设置 (0.1-2.0)
└── 上下文管理
```

## Acceptance Criteria

### 功能性需求
1. 系统必须能够根据模型ID自动识别复杂度级别
2. 系统必须能够在不同界面模式间平滑切换
3. 系统必须保持参数状态在模式切换时不丢失
4. 系统必须支持参数预设的保存和加载
5. 系统必须提供参数验证和错误提示

### 性能需求
1. 界面模式切换必须在200ms内完成
2. 参数面板展开/收缩动画必须流畅（60fps）
3. 参数预设加载必须在100ms内完成

### 可用性需求
1. 参数控件必须提供清晰的标签和说明
2. 复杂参数必须提供帮助提示
3. 参数面板必须支持键盘导航
4. 参数设置必须提供实时预览（如适用）

### 兼容性需求
1. 必须支持桌面端和移动端
2. 必须兼容现有的模型选择器
3. 必须与现有的DynamicMenu集成
4. 必须支持深色/浅色主题

## Integration Points

### 与现有系统的集成

#### DynamicMenu集成
- 在DynamicMenu中添加"参数配置"按钮
- 按钮样式与现有按钮保持一致
- 支持快捷键触发 (Ctrl+P)

#### ModelSelector集成  
- 参数面板中的模型选择与ModelSelector同步
- 模型切换时自动更新可用参数
- 保持模型选择的一致性

#### 现有Modal组件复用
- 复用VideoAdvancedEditModal的布局结构
- 复用ImageEditModal的参数管理逻辑
- 统一模态框的样式和交互

### 数据流设计

```
用户操作 → DynamicMenu → 参数面板 → 参数验证 → API调用
    ↓           ↓           ↓           ↓           ↓
 点击按钮    弹出面板    配置参数    验证参数    生成内容
    ↓           ↓           ↓           ↓           ↓
 快捷键      标签切换    预设管理    错误提示    结果展示
```

## Success Metrics

### 用户体验指标
- 参数配置完成时间减少 50%
- 用户参数配置错误率降低 70%
- 高级功能使用率提升 200%

### 技术性能指标
- 面板打开时间 < 200ms
- 标签切换响应时间 < 100ms
- 参数验证响应时间 < 50ms

### 功能覆盖指标
- 支持所有现有模型的参数配置
- 支持所有现有功能的参数设置
- 提供 90% 以上的参数预设覆盖