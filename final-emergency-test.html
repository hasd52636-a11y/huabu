<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€ç»ˆç´§æ€¥ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 700px;
            margin: 30px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .test-link {
            display: block;
            padding: 18px 30px;
            margin: 15px 0;
            border-radius: 10px;
            text-decoration: none;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .danger-link {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }
        .danger-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        .safe-link {
            background: linear-gradient(45deg, #00d2d3, #54a0ff);
            color: white;
        }
        .safe-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 210, 211, 0.4);
        }
        .warning {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        .fix-info {
            background: rgba(40, 167, 69, 0.2);
            border: 2px solid #28a745;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
            font-size: 14px;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }
        .status.success {
            background: rgba(40, 167, 69, 0.3);
            border: 1px solid #28a745;
        }
        .status.error {
            background: rgba(220, 53, 69, 0.3);
            border: 1px solid #dc3545;
        }
        .btn {
            background: rgba(108, 117, 125, 0.8);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: rgba(108, 117, 125, 1);
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›¡ï¸ æœ€ç»ˆç´§æ€¥ä¿®å¤æµ‹è¯•</h1>
        
        <div class="warning">
            âš ï¸ å¼ºåŒ–ä¿®å¤å·²éƒ¨ç½²ï¼é—®é¢˜IDç°åœ¨ä¼šè¢«å¤šå±‚æ‹¦æˆª
        </div>
        
        <div class="fix-info">
            <h3>ğŸ”§ ä¿®å¤ç­–ç•¥ï¼š</h3>
            <ul style="text-align: left; margin: 10px 0;">
                <li>âœ… useShareMode Hook ä¸­ç«‹å³æ‹¦æˆªé—®é¢˜ID</li>
                <li>âœ… connectToShare å‡½æ•°ä¸­äºŒæ¬¡å®‰å…¨æ£€æŸ¥</li>
                <li>âœ… MinimalViewerPage ä¸­ä¸‰é‡éªŒè¯</li>
                <li>âœ… è‡ªåŠ¨æ¸…ç†æŸåçš„localStorageæ•°æ®</li>
                <li>âœ… å®Œå…¨é˜»æ­¢RealtimeShareServiceå¤æ‚é€»è¾‘æ‰§è¡Œ</li>
            </ul>
        </div>
        
        <h2>ğŸ§ª æµ‹è¯•é“¾æ¥</h2>
        
        <a href="http://localhost:3005/" class="test-link safe-link">
            âœ… ä¸»åº”ç”¨ï¼ˆå®‰å…¨åŸºçº¿ï¼‰
        </a>
        
        <a href="http://localhost:3005/?watch=test-share-123" class="test-link safe-link">
            âœ… æ­£å¸¸åˆ†äº«IDï¼ˆåŠŸèƒ½éªŒè¯ï¼‰
        </a>
        
        <a href="http://localhost:3005/?watch=share-1769056688844-v3iise" class="test-link danger-link">
            ğŸ›¡ï¸ é—®é¢˜åˆ†äº«IDï¼ˆä¿®å¤éªŒè¯ï¼‰
        </a>
        
        <div class="status" id="testStatus" style="display: none;">
            æµ‹è¯•çŠ¶æ€å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
        </div>
        
        <div style="margin-top: 30px;">
            <h3>ğŸ”§ å·¥å…·</h3>
            <button onclick="clearAllStorage()" class="btn">
                ğŸ—‘ï¸ æ¸…ç†æ‰€æœ‰å­˜å‚¨
            </button>
            <button onclick="runDiagnostic()" class="btn">
                ğŸ” è¿è¡Œè¯Šæ–­
            </button>
            <button onclick="testProblematicId()" class="btn">
                âš¡ å¿«é€Ÿæµ‹è¯•é—®é¢˜ID
            </button>
        </div>
        
        <div style="margin-top: 30px; font-size: 12px; opacity: 0.8;">
            <p><strong>é¢„æœŸç»“æœï¼š</strong></p>
            <p>é—®é¢˜IDåº”è¯¥ç«‹å³æ˜¾ç¤ºæŠ€æœ¯é—®é¢˜é”™è¯¯é¡µé¢ï¼Œä¸å†å‡ºç°ç™½å±æˆ–æµè§ˆå™¨å´©æºƒ</p>
            <p>å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·ç«‹å³å…³é—­æ ‡ç­¾é¡µå¹¶æŠ¥å‘Š</p>
        </div>
    </div>

    <script>
        function clearAllStorage() {
            try {
                localStorage.clear();
                sessionStorage.clear();
                
                // æ¸…ç†ç‰¹å®šçš„åˆ†äº«ä¼šè¯æ•°æ®
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.startsWith('share-session-')) {
                        localStorage.removeItem(key);
                    }
                });
                
                showStatus('å­˜å‚¨å·²å®Œå…¨æ¸…ç†', 'success');
            } catch (error) {
                showStatus('æ¸…ç†å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function runDiagnostic() {
            const results = [];
            
            // æ£€æŸ¥localStorageä¸­çš„åˆ†äº«ä¼šè¯
            const keys = Object.keys(localStorage);
            const shareKeys = keys.filter(key => key.startsWith('share-session-'));
            
            results.push(`å‘ç° ${shareKeys.length} ä¸ªåˆ†äº«ä¼šè¯æ•°æ®`);
            
            shareKeys.forEach(key => {
                try {
                    const data = JSON.parse(localStorage.getItem(key));
                    results.push(`- ${key}: ${data.id || 'æ— ID'} (${data.isActive ? 'æ´»è·ƒ' : 'éæ´»è·ƒ'})`);
                } catch (error) {
                    results.push(`- ${key}: æ•°æ®æŸå`);
                }
            });
            
            // æ£€æŸ¥é—®é¢˜ID
            const problematicId = 'share-1769056688844-v3iise';
            if (localStorage.getItem(`share-session-${problematicId}`)) {
                results.push(`âš ï¸ å‘ç°é—®é¢˜IDæ•°æ®: ${problematicId}`);
            } else {
                results.push(`âœ… é—®é¢˜IDæ•°æ®å·²æ¸…ç†: ${problematicId}`);
            }
            
            showStatus(results.join('\n'), 'success');
        }
        
        function testProblematicId() {
            showStatus('æ­£åœ¨æµ‹è¯•é—®é¢˜ID...', 'success');
            
            // åˆ›å»ºéšè—çš„iframeæ¥æµ‹è¯•
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'http://localhost:3005/?watch=share-1769056688844-v3iise';
            
            let testTimeout;
            
            iframe.onload = function() {
                clearTimeout(testTimeout);
                showStatus('âœ… é—®é¢˜IDåŠ è½½æˆåŠŸï¼Œæ²¡æœ‰å´©æºƒï¼', 'success');
                document.body.removeChild(iframe);
            };
            
            iframe.onerror = function() {
                clearTimeout(testTimeout);
                showStatus('âŒ é—®é¢˜IDä»ç„¶å­˜åœ¨åŠ è½½é—®é¢˜', 'error');
                document.body.removeChild(iframe);
            };
            
            // 5ç§’è¶…æ—¶
            testTimeout = setTimeout(() => {
                showStatus('â±ï¸ æµ‹è¯•è¶…æ—¶ï¼Œå¯èƒ½ä»æœ‰é—®é¢˜', 'error');
                document.body.removeChild(iframe);
            }, 5000);
            
            document.body.appendChild(iframe);
        }
        
        function showStatus(message, type) {
            const statusEl = document.getElementById('testStatus');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 3000);
        }
        
        console.log('ğŸ›¡ï¸ æœ€ç»ˆç´§æ€¥ä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
        console.log('ä¿®å¤æ–¹æ¡ˆ: å¤šå±‚æ‹¦æˆª + æ•°æ®æ¸…ç† + é€»è¾‘é˜»æ–­');
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œè¯Šæ–­
        setTimeout(runDiagnostic, 1000);
    </script>
</body>
</html>