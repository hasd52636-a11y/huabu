<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†äº«åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .step {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }
        .warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }
        .code {
            background: #f1f3f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .url-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            word-break: break-all;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ¨ æ›¹æ“ç”»å¸ƒåˆ†äº«åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="step success">
        <h3>âœ… ä¿®å¤å®Œæˆ</h3>
        <p>åˆ†äº«åŠŸèƒ½å·²ç»ä¿®å¤ï¼Œç°åœ¨æ”¯æŒï¼š</p>
        <ul>
            <li>å®æ—¶ç”»å¸ƒå†…å®¹åŒæ­¥</li>
            <li>è‡ªåŠ¨åˆ·æ–°è§‚çœ‹æ¨¡å¼</li>
            <li>å®Œæ•´çš„æ¨¡å—å’Œè¿æ¥çº¿æ˜¾ç¤º</li>
            <li>çŠ¶æ€æŒ‡ç¤ºå™¨å’Œç¼©æ”¾æ”¯æŒ</li>
        </ul>
    </div>

    <div class="step">
        <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤</h3>
        <ol>
            <li>æ‰“å¼€ä¸»åº”ç”¨ï¼š<button onclick="openMain()">æ‰“å¼€æ›¹æ“ç”»å¸ƒ</button></li>
            <li>åœ¨ç”»å¸ƒä¸Šæ·»åŠ ä¸€äº›æ¨¡å—ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ï¼‰</li>
            <li>ç‚¹å‡»å·¦ä¾§å·¥å…·æ çš„åˆ†äº«æŒ‰é’® ğŸ“¤</li>
            <li>å¤åˆ¶åˆ†äº«é“¾æ¥</li>
            <li>åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€åˆ†äº«é“¾æ¥</li>
            <li>éªŒè¯è§‚ä¼—å¯ä»¥çœ‹åˆ°å®æ—¶çš„ç”»å¸ƒå†…å®¹</li>
        </ol>
    </div>

    <div class="step">
        <h3>ğŸ”§ å¿«é€Ÿæµ‹è¯•</h3>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¿«é€Ÿæµ‹è¯•åˆ†äº«åŠŸèƒ½ï¼š</p>
        <button onclick="createTestShare()">åˆ›å»ºæµ‹è¯•åˆ†äº«</button>
        <button onclick="viewTestShare()">æŸ¥çœ‹æµ‹è¯•åˆ†äº«</button>
        <div id="testResult"></div>
    </div>

    <div class="step warning">
        <h3>âš ï¸ æ³¨æ„äº‹é¡¹</h3>
        <ul>
            <li>åˆ†äº«åŠŸèƒ½ä½¿ç”¨ localStorageï¼Œåªåœ¨åŒä¸€æµè§ˆå™¨ä¸­æœ‰æ•ˆ</li>
            <li>è¿™æ˜¯ç®€åŒ–ç‰ˆæœ¬ï¼Œé€‚åˆæœ¬åœ°æµ‹è¯•å’Œæ¼”ç¤º</li>
            <li>è§‚ä¼—ç«¯æ¯2ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡å†…å®¹</li>
            <li>å¯ä»¥æš‚åœ/æ¢å¤è‡ªåŠ¨åˆ·æ–°</li>
        </ul>
    </div>

    <div class="step">
        <h3>ğŸš€ éƒ¨ç½²çŠ¶æ€</h3>
        <p>ä»£ç å·²æ¨é€åˆ° GitHubï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼š</p>
        <ul>
            <li><strong>æœ¬åœ°å¼€å‘ï¼š</strong> <span class="code">http://localhost:5173</span></li>
            <li><strong>GitHub Pagesï¼š</strong> éœ€è¦é…ç½®éƒ¨ç½²</li>
            <li><strong>Vercelï¼š</strong> è‡ªåŠ¨éƒ¨ç½²å·²é…ç½®</li>
        </ul>
    </div>

    <script>
        function openMain() {
            window.open('http://localhost:5173', '_blank');
        }

        function createTestShare() {
            // åˆ›å»ºæµ‹è¯•æ•°æ®
            const testShareId = 'test-' + Date.now();
            const testData = {
                shareId: testShareId,
                timestamp: Date.now(),
                canvasState: {
                    blocks: [
                        {
                            id: 'test-block-1',
                            type: 'text',
                            x: 100,
                            y: 100,
                            width: 300,
                            height: 150,
                            content: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡æœ¬æ¨¡å—\n\nåˆ†äº«åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼\n\nå½“å‰æ—¶é—´: ' + new Date().toLocaleTimeString(),
                            status: 'idle',
                            number: 'A01'
                        },
                        {
                            id: 'test-block-2',
                            type: 'image',
                            x: 500,
                            y: 100,
                            width: 400,
                            height: 300,
                            content: '',
                            status: 'idle',
                            number: 'B01'
                        },
                        {
                            id: 'test-block-3',
                            type: 'text',
                            x: 100,
                            y: 300,
                            width: 350,
                            height: 120,
                            content: 'æµ‹è¯•æ¨¡å— #3\n\nè¿™ä¸ªåˆ†äº«åŠŸèƒ½ç°åœ¨åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼',
                            status: 'idle',
                            number: 'A02'
                        }
                    ],
                    connections: [
                        {
                            id: 'test-conn-1',
                            fromId: 'test-block-1',
                            toId: 'test-block-2',
                            instruction: 'æµ‹è¯•è¿æ¥'
                        }
                    ],
                    zoom: 1,
                    pan: { x: 0, y: 0 }
                },
                status: 'active',
                message: 'æµ‹è¯•åˆ†äº«å·²åˆ›å»º',
                lastUpdate: Date.now()
            };

            localStorage.setItem(`canvas-share-${testShareId}`, JSON.stringify(testData));
            
            const testUrl = `http://localhost:5173?watch=${testShareId}`;
            document.getElementById('testResult').innerHTML = `
                <div class="success" style="margin-top: 15px;">
                    <h4>âœ… æµ‹è¯•åˆ†äº«å·²åˆ›å»º</h4>
                    <p>åˆ†äº«ID: <span class="code">${testShareId}</span></p>
                    <p>åŒ…å« ${testData.canvasState.blocks.length} ä¸ªæ¨¡å—å’Œ ${testData.canvasState.connections.length} ä¸ªè¿æ¥</p>
                    <div class="url-box">${testUrl}</div>
                    <button onclick="window.open('${testUrl}', '_blank')">æ‰“å¼€æµ‹è¯•åˆ†äº«</button>
                    <button onclick="updateTestShare('${testShareId}')">æ›´æ–°æµ‹è¯•å†…å®¹</button>
                </div>
            `;
        }

        function updateTestShare(shareId) {
            const existingData = JSON.parse(localStorage.getItem(`canvas-share-${shareId}`) || '{}');
            if (existingData.canvasState) {
                // æ›´æ–°ç¬¬ä¸€ä¸ªæ–‡æœ¬å—çš„å†…å®¹
                existingData.canvasState.blocks[0].content = 'å†…å®¹å·²æ›´æ–°ï¼\n\næ›´æ–°æ—¶é—´: ' + new Date().toLocaleTimeString() + '\n\nè¿™è¯æ˜äº†å®æ—¶åŒæ­¥åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼';
                existingData.lastUpdate = Date.now();
                
                localStorage.setItem(`canvas-share-${shareId}`, JSON.stringify(existingData));
                
                document.getElementById('testResult').innerHTML += `
                    <div style="margin-top: 10px; padding: 10px; background: #d1ecf1; border-radius: 5px; border-left: 4px solid #bee5eb;">
                        <p><strong>âœ… å†…å®¹å·²æ›´æ–°</strong> - è§‚ä¼—ç«¯åº”è¯¥ä¼šåœ¨2ç§’å†…çœ‹åˆ°æ›´æ–°</p>
                    </div>
                `;
            }
        }

        function viewTestShare() {
            // æŸ¥æ‰¾æœ€æ–°çš„æµ‹è¯•åˆ†äº«
            const keys = Object.keys(localStorage).filter(key => key.startsWith('canvas-share-test-'));
            if (keys.length === 0) {
                document.getElementById('testResult').innerHTML = `
                    <div class="warning" style="margin-top: 15px;">
                        <p>âŒ æ²¡æœ‰æ‰¾åˆ°æµ‹è¯•åˆ†äº«ï¼Œè¯·å…ˆåˆ›å»ºä¸€ä¸ª</p>
                    </div>
                `;
                return;
            }

            const latestKey = keys.sort().pop();
            const shareId = latestKey.replace('canvas-share-', '');
            const testUrl = `http://localhost:5173?watch=${shareId}`;
            
            window.open(testUrl, '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰çŠ¶æ€
        window.onload = function() {
            const shareCount = Object.keys(localStorage).filter(key => key.startsWith('canvas-share-')).length;
            if (shareCount > 0) {
                document.getElementById('testResult').innerHTML = `
                    <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 5px;">
                        <p>ğŸ“Š å½“å‰æœ‰ ${shareCount} ä¸ªåˆ†äº«è®°å½•</p>
                    </div>
                `;
            }
        };
    </script>
</body>
</html>