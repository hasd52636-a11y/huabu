<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼˜åŒ–åˆ†äº«æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { background-color: #d4edda; border-left: 4px solid #28a745; }
        .info { background-color: #d1ecf1; border-left: 4px solid #17a2b8; }
        .warning { background-color: #fff3cd; border-left: 4px solid #ffc107; }
        button { padding: 12px 20px; margin: 8px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-info { background: #17a2b8; color: white; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 6px; text-align: center; }
        .stat-number { font-size: 24px; font-weight: bold; color: #007bff; }
        .stat-label { font-size: 12px; color: #666; margin-top: 5px; }
        #log { height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; font-family: 'Courier New', monospace; font-size: 12px; background: #f8f9fa; border-radius: 6px; }
        .feature-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .feature-item { padding: 15px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #007bff; }
        .feature-title { font-weight: bold; color: #007bff; margin-bottom: 8px; }
        .feature-desc { font-size: 14px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ä¼˜åŒ–åˆ†äº«ç³»ç»Ÿæµ‹è¯•</h1>
        
        <div class="section success">
            <h3>âœ¨ ä¼˜åŒ–ç‰¹æ€§</h3>
            <div class="feature-list">
                <div class="feature-item">
                    <div class="feature-title">ğŸ“¦ å¢é‡åŒæ­¥</div>
                    <div class="feature-desc">åªä¼ è¾“å˜åŒ–çš„éƒ¨åˆ†ï¼Œå¤§å¹…å‡å°‘æ•°æ®é‡</div>
                </div>
                <div class="feature-item">
                    <div class="feature-title">ğŸ—œï¸ æ™ºèƒ½å‹ç¼©</div>
                    <div class="feature-desc">è‡ªåŠ¨å‹ç¼©ç”»å¸ƒæ•°æ®ï¼Œç§»é™¤å†—ä½™ä¿¡æ¯</div>
                </div>
                <div class="feature-item">
                    <div class="feature-title">âš¡ æ€§èƒ½èŠ‚æµ</div>
                    <div class="feature-desc">æ§åˆ¶åŒæ­¥é¢‘ç‡ï¼Œé¿å…è¿‡åº¦ä¼ è¾“</div>
                </div>
                <div class="feature-item">
                    <div class="feature-title">ğŸ¯ æ•°æ®ä¼˜åŒ–</div>
                    <div class="feature-desc">ç§»é™¤é‡å¤æ•°æ®ï¼Œä¼˜åŒ–æ•°ç»„ç»“æ„</div>
                </div>
            </div>
        </div>

        <div class="section info">
            <h3>ğŸ“Š æ€§èƒ½ç»Ÿè®¡</h3>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="compressionRatio">0%</div>
                    <div class="stat-label">æ•°æ®å‹ç¼©ç‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="deltaChanges">0</div>
                    <div class="stat-label">å¢é‡å˜åŒ–æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="dataSize">0KB</div>
                    <div class="stat-label">ä¼ è¾“æ•°æ®å¤§å°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="syncLatency">0ms</div>
                    <div class="stat-label">åŒæ­¥å»¶è¿Ÿ</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ§ª æµ‹è¯•æ“ä½œ</h3>
            <div style="margin-bottom: 20px;">
                <button class="btn-primary" onclick="openMainApp()">ğŸ¨ æ‰“å¼€ä¸»åº”ç”¨</button>
                <button class="btn-success" onclick="createTestContent()">ğŸ“ åˆ›å»ºæµ‹è¯•å†…å®¹</button>
                <button class="btn-info" onclick="simulateChanges()">ğŸ”„ æ¨¡æ‹Ÿå˜åŒ–</button>
                <button class="btn-warning" onclick="testViewer()">ğŸ‘ï¸ æµ‹è¯•è§‚çœ‹è€…</button>
            </div>
            
            <div>
                <input type="text" id="shareUrl" placeholder="ç²˜è´´åˆ†äº«é“¾æ¥è¿›è¡Œæµ‹è¯•..." style="width: 400px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-right: 10px;">
                <button class="btn-success" onclick="openViewer()">æ‰“å¼€è§‚çœ‹é¡µé¢</button>
            </div>
        </div>

        <div class="section warning">
            <h3>âš ï¸ æµ‹è¯•æŒ‡å—</h3>
            <ol>
                <li><strong>åŸºç¡€æµ‹è¯•ï¼š</strong>æ‰“å¼€ä¸»åº”ç”¨ï¼Œåˆ›å»ºå†…å®¹ï¼Œå¼€å§‹åˆ†äº«</li>
                <li><strong>æ€§èƒ½æµ‹è¯•ï¼š</strong>åˆ›å»ºå¤§é‡å†…å®¹ï¼Œè§‚å¯Ÿå‹ç¼©æ•ˆæœ</li>
                <li><strong>å¢é‡æµ‹è¯•ï¼š</strong>ç§»åŠ¨ã€ä¿®æ”¹å†…å®¹ï¼Œè§‚å¯Ÿå¢é‡åŒæ­¥</li>
                <li><strong>å¤šè§‚çœ‹è€…ï¼š</strong>å¤šä¸ªæ ‡ç­¾é¡µåŒæ—¶è§‚çœ‹ï¼Œæµ‹è¯•å¹¶å‘æ€§èƒ½</li>
                <li><strong>ç½‘ç»œæµ‹è¯•ï¼š</strong>åœ¨ä¸åŒç½‘ç»œæ¡ä»¶ä¸‹æµ‹è¯•ç¨³å®šæ€§</li>
            </ol>
        </div>

        <div class="section">
            <h3>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h3>
            <button onclick="clearLog()" style="float: right; padding: 5px 10px; font-size: 12px;">æ¸…ç©º</button>
            <div id="log"></div>
        </div>
    </div>

    <script>
        let testStats = {
            compressionRatio: 0,
            deltaChanges: 0,
            dataSize: 0,
            syncLatency: 0
        };

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#333',
                success: '#28a745',
                warning: '#ffc107',
                error: '#dc3545'
            };
            logDiv.innerHTML += `<div style="color: ${colors[type] || colors.info}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStats() {
            document.getElementById('compressionRatio').textContent = testStats.compressionRatio + '%';
            document.getElementById('deltaChanges').textContent = testStats.deltaChanges;
            document.getElementById('dataSize').textContent = (testStats.dataSize / 1024).toFixed(1) + 'KB';
            document.getElementById('syncLatency').textContent = testStats.syncLatency + 'ms';
        }

        function openMainApp() {
            log('ğŸ¨ æ­£åœ¨æ‰“å¼€ä¸»åº”ç”¨...', 'info');
            window.open('http://localhost:3005/', '_blank');
            log('âœ… ä¸»åº”ç”¨å·²æ‰“å¼€ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š', 'success');
            log('1. åˆ›å»ºä¸€äº›æ–‡æœ¬å—å’Œå›¾ç‰‡', 'info');
            log('2. ç‚¹å‡»å·¦ä¾§å·¥å…·æ çš„åˆ†äº«æŒ‰é’®', 'info');
            log('3. å¤åˆ¶åˆ†äº«é“¾æ¥åˆ°è¿™é‡Œæµ‹è¯•', 'info');
            
            // æ¨¡æ‹Ÿç»Ÿè®¡æ•°æ®æ›´æ–°
            setTimeout(() => {
                testStats.compressionRatio = Math.floor(Math.random() * 30) + 40; // 40-70%
                testStats.syncLatency = Math.floor(Math.random() * 50) + 10; // 10-60ms
                updateStats();
            }, 2000);
        }

        function createTestContent() {
            log('ğŸ“ æ¨¡æ‹Ÿåˆ›å»ºæµ‹è¯•å†…å®¹...', 'info');
            log('å»ºè®®åœ¨ä¸»åº”ç”¨ä¸­åˆ›å»ºä»¥ä¸‹å†…å®¹ï¼š', 'warning');
            log('â€¢ 5-10ä¸ªæ–‡æœ¬å—ï¼ˆä¸åŒå¤§å°å’Œä½ç½®ï¼‰', 'info');
            log('â€¢ 2-3å¼ å›¾ç‰‡', 'info');
            log('â€¢ å‡ ä¸ªè¿æ¥çº¿', 'info');
            log('â€¢ è°ƒæ•´ç¼©æ”¾å’Œå¹³ç§»', 'info');
            
            // æ¨¡æ‹Ÿæ•°æ®å¤§å°ç»Ÿè®¡
            testStats.dataSize = Math.floor(Math.random() * 5000) + 2000; // 2-7KB
            testStats.deltaChanges = Math.floor(Math.random() * 10) + 5; // 5-15ä¸ªå˜åŒ–
            updateStats();
        }

        function simulateChanges() {
            log('ğŸ”„ æ¨¡æ‹Ÿç”»å¸ƒå˜åŒ–...', 'info');
            
            const changes = [
                'ç§»åŠ¨æ–‡æœ¬å—ä½ç½®',
                'ä¿®æ”¹æ–‡æœ¬å†…å®¹',
                'è°ƒæ•´å—å¤§å°',
                'æ”¹å˜ç¼©æ”¾çº§åˆ«',
                'å¹³ç§»ç”»å¸ƒè§†è§’',
                'æ·»åŠ æ–°è¿æ¥',
                'åˆ é™¤æ—§å…ƒç´ '
            ];
            
            let changeCount = 0;
            const interval = setInterval(() => {
                if (changeCount >= 5) {
                    clearInterval(interval);
                    log('âœ… å˜åŒ–æ¨¡æ‹Ÿå®Œæˆï¼Œè§‚å¯Ÿå¢é‡åŒæ­¥æ•ˆæœ', 'success');
                    return;
                }
                
                const change = changes[Math.floor(Math.random() * changes.length)];
                log(`ğŸ“Š æ¨¡æ‹Ÿå˜åŒ– ${changeCount + 1}: ${change}`, 'info');
                
                // æ›´æ–°ç»Ÿè®¡
                testStats.deltaChanges = changeCount + 1;
                testStats.compressionRatio = Math.min(testStats.compressionRatio + 5, 85);
                testStats.syncLatency = Math.floor(Math.random() * 30) + 15;
                updateStats();
                
                changeCount++;
            }, 1000);
        }

        function testViewer() {
            const shareUrl = document.getElementById('shareUrl').value.trim();
            if (!shareUrl) {
                log('âŒ è¯·å…ˆè¾“å…¥åˆ†äº«é“¾æ¥', 'error');
                return;
            }
            
            log('ğŸ‘ï¸ æµ‹è¯•è§‚çœ‹è€…æ¨¡å¼...', 'info');
            openViewer();
            
            setTimeout(() => {
                log('ğŸ” è¯·æ£€æŸ¥è§‚çœ‹é¡µé¢ï¼š', 'warning');
                log('â€¢ æ˜¯å¦æ˜¾ç¤º"è§‚çœ‹æ¨¡å¼"çŠ¶æ€æ ï¼Ÿ', 'info');
                log('â€¢ æ˜¯å¦èƒ½çœ‹åˆ°æ‰€æœ‰ç”»å¸ƒå†…å®¹ï¼Ÿ', 'info');
                log('â€¢ æ˜¯å¦æ— æ³•ç¼–è¾‘ä»»ä½•å†…å®¹ï¼Ÿ', 'info');
                log('â€¢ ä¸»æœºæ“ä½œæ˜¯å¦å®æ—¶åŒæ­¥ï¼Ÿ', 'info');
            }, 2000);
        }

        function openViewer() {
            const shareUrl = document.getElementById('shareUrl').value.trim();
            if (!shareUrl) {
                log('âŒ è¯·å…ˆè¾“å…¥åˆ†äº«é“¾æ¥', 'error');
                return;
            }

            try {
                const url = new URL(shareUrl);
                const watchParam = url.searchParams.get('watch');
                
                if (!watchParam) {
                    log('âŒ æ— æ•ˆçš„åˆ†äº«é“¾æ¥æ ¼å¼', 'error');
                    return;
                }
                
                log(`ğŸ”— æ‰“å¼€è§‚çœ‹é¡µé¢: ${watchParam}`, 'success');
                window.open(shareUrl, '_blank');
                
                // æ¨¡æ‹Ÿæ¥æ”¶æ•°æ®ç»Ÿè®¡
                setTimeout(() => {
                    testStats.dataSize = Math.floor(Math.random() * 3000) + 1000;
                    testStats.syncLatency = Math.floor(Math.random() * 40) + 20;
                    updateStats();
                    log('ğŸ“¡ å¼€å§‹æ¥æ”¶å®æ—¶æ•°æ®...', 'success');
                }, 3000);
                
            } catch (error) {
                log(`âŒ é“¾æ¥æ ¼å¼é”™è¯¯: ${error.message}`, 'error');
            }
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            log('ğŸ“‹ æµ‹è¯•æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        window.onload = function() {
            log('ğŸš€ ä¼˜åŒ–åˆ†äº«ç³»ç»Ÿæµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
            log('ğŸ“ˆ å½“å‰ä¼˜åŒ–ç‰¹æ€§ï¼š', 'info');
            log('â€¢ å¢é‡åŒæ­¥ï¼šåªä¼ è¾“å˜åŒ–éƒ¨åˆ†', 'info');
            log('â€¢ æ™ºèƒ½å‹ç¼©ï¼šè‡ªåŠ¨ä¼˜åŒ–æ•°æ®ç»“æ„', 'info');
            log('â€¢ æ€§èƒ½èŠ‚æµï¼šæ§åˆ¶åŒæ­¥é¢‘ç‡', 'info');
            log('â€¢ æ•°æ®å»é‡ï¼šç§»é™¤é‡å¤å†…å®¹', 'info');
            log('ğŸ§ª è¯·æŒ‰ç…§æµ‹è¯•æŒ‡å—è¿›è¡Œå®Œæ•´æµ‹è¯•', 'warning');
            
            updateStats();
        };

        // å®šæœŸæ›´æ–°æ¨¡æ‹Ÿç»Ÿè®¡
        setInterval(() => {
            if (testStats.syncLatency > 0) {
                testStats.syncLatency = Math.max(testStats.syncLatency + (Math.random() - 0.5) * 10, 10);
                updateStats();
            }
        }, 5000);
    </script>
</body>
</html>