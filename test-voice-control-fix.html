<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³æ§åˆ¶å…³é—­ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 32px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
        }
        .test-section h3 {
            margin: 0 0 16px 0;
            color: #1f2937;
            font-size: 18px;
            font-weight: 600;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin-left: 12px;
        }
        .status.fixed {
            background: #dcfce7;
            color: #166534;
        }
        .status.testing {
            background: #dbeafe;
            color: #1d4ed8;
        }
        .feature-list {
            list-style: none;
            padding: 0;
            margin: 16px 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            align-items: center;
        }
        .feature-list li:last-child {
            border-bottom: none;
        }
        .check {
            color: #10b981;
            margin-right: 8px;
            font-weight: bold;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            margin: 8px 8px 8px 0;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .test-button.secondary {
            background: #6b7280;
        }
        .test-button.secondary:hover {
            background: #4b5563;
        }
        .instructions {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .instructions h4 {
            margin: 0 0 8px 0;
            color: #92400e;
        }
        .instructions p {
            margin: 4px 0;
            color: #78350f;
        }
        .problem-description {
            background: #fee2e2;
            border: 1px solid #ef4444;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .problem-description h4 {
            margin: 0 0 8px 0;
            color: #dc2626;
        }
        .problem-description p {
            margin: 4px 0;
            color: #991b1b;
        }
        .fix-description {
            background: #d1fae5;
            border: 1px solid #10b981;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .fix-description h4 {
            margin: 0 0 8px 0;
            color: #059669;
        }
        .fix-description p {
            margin: 4px 0;
            color: #047857;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ è¯­éŸ³æ§åˆ¶å…³é—­ä¿®å¤æµ‹è¯•</h1>
        <p>æµ‹è¯•è¯­éŸ³æ§åˆ¶å…³é—­æŒ‰é’®æ˜¯å¦èƒ½æ­£ç¡®åœæ­¢è¯­éŸ³ç›‘å¬</p>

        <div class="test-section">
            <h3>ğŸ› é—®é¢˜æè¿° <span class="status fixed">âœ… å·²ä¿®å¤</span></h3>
            <div class="problem-description">
                <h4>ç”¨æˆ·æŠ¥å‘Šçš„é—®é¢˜:</h4>
                <p><strong>"è¯­éŸ³æ§åˆ¶æˆ‘ç‚¹å‡»å…³é—­åæŒ‰é’®æ˜¾ç¤ºå…³é—­äº†ï¼Œä½†å®è´¨ä¸Šæ²¡æœ‰å…³é—­è¿˜åœ¨ç»§ç»­æ”¶å¬"</strong></p>
                
                <h4>é—®é¢˜åˆ†æ:</h4>
                <p>â€¢ ç”¨æˆ·ç‚¹å‡»å…³é—­æŒ‰é’®åï¼ŒUIçŠ¶æ€æ›´æ–°ä¸ºå…³é—­</p>
                <p>â€¢ ä½†è¯­éŸ³è¯†åˆ«çš„SpeechRecognitionä»åœ¨åå°è¿è¡Œ</p>
                <p>â€¢ onendäº‹ä»¶å¤„ç†å™¨ä¼šè‡ªåŠ¨é‡å¯è¯­éŸ³è¯†åˆ«</p>
                <p>â€¢ å¯¼è‡´è™½ç„¶æŒ‰é’®æ˜¾ç¤ºå…³é—­ï¼Œä½†å®é™…ä»åœ¨ç›‘å¬</p>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ ä¿®å¤æ–¹æ¡ˆ <span class="status fixed">âœ… å·²å®æ–½</span></h3>
            <div class="fix-description">
                <h4>ä¿®å¤å†…å®¹:</h4>
                <p><strong>1. å¼ºåŒ–stopListeningå‡½æ•°</strong></p>
                <p>â€¢ ç«‹å³è®¾ç½®isListeningå’ŒisProcessingä¸ºfalse</p>
                <p>â€¢ æ¸…ç†é”™è¯¯è®¡æ•°å’Œé”™è¯¯çŠ¶æ€</p>
                <p>â€¢ æ·»åŠ æ›´è¯¦ç»†çš„æ—¥å¿—è¾“å‡º</p>
                
                <p><strong>2. æ”¹è¿›onendäº‹ä»¶å¤„ç†å™¨</strong></p>
                <p>â€¢ æ·»åŠ ä¸‰é‡æ£€æŸ¥æœºåˆ¶é˜²æ­¢æ„å¤–é‡å¯</p>
                <p>â€¢ åœ¨å»¶è¿Ÿé‡å¯å‰å†æ¬¡ç¡®è®¤æ¿€æ´»çŠ¶æ€</p>
                <p>â€¢ å¢å¼ºæ—¥å¿—è¾“å‡ºä¾¿äºè°ƒè¯•</p>
                
                <p><strong>3. å¼ºåŒ–useEffectç›‘å¬</strong></p>
                <p>â€¢ åœ¨å…³é—­æ—¶å¼ºåˆ¶åœæ­¢è¯­éŸ³è¯†åˆ«</p>
                <p>â€¢ æ¸…é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨é˜²æ­¢å›è°ƒè§¦å‘</p>
                <p>â€¢ ç¡®ä¿å®Œå…¨æ¸…ç†æ‰€æœ‰ç›¸å…³çŠ¶æ€</p>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ§ª æµ‹è¯•æ­¥éª¤ <span class="status testing">ğŸ”„ å‡†å¤‡æµ‹è¯•</span></h3>
            
            <div class="instructions">
                <h4>ğŸ“ è¯¦ç»†æµ‹è¯•æµç¨‹:</h4>
                <p><strong>æ­¥éª¤1:</strong> æ‰“å¼€ä¸»åº”ç”¨å¹¶åˆ‡æ¢åˆ°"æ›¹æ“"æ ‡ç­¾é¡µ</p>
                <p><strong>æ­¥éª¤2:</strong> ç‚¹å‡»"è¯­éŸ³æ§åˆ¶"æŒ‰é’®æ¿€æ´»è¯­éŸ³ç›‘å¬</p>
                <p><strong>æ­¥éª¤3:</strong> ç¡®è®¤çœ‹åˆ°"ğŸ¤ è¯­éŸ³ç›‘å¬ä¸­"çŠ¶æ€æç¤º</p>
                <p><strong>æ­¥éª¤4:</strong> è¯´ä¸€å¥è¯æµ‹è¯•è¯­éŸ³è¯†åˆ«æ˜¯å¦å·¥ä½œ</p>
                <p><strong>æ­¥éª¤5:</strong> ç‚¹å‡»"è¯­éŸ³æ§åˆ¶"æŒ‰é’®å…³é—­è¯­éŸ³ç›‘å¬</p>
                <p><strong>æ­¥éª¤6:</strong> ç¡®è®¤çŠ¶æ€å˜ä¸º"â¸ï¸ è¯­éŸ³å·²æš‚åœ"</p>
                <p><strong>æ­¥éª¤7:</strong> è¯´è¯æµ‹è¯•æ˜¯å¦è¿˜åœ¨ç›‘å¬ï¼ˆåº”è¯¥æ²¡æœ‰ååº”ï¼‰</p>
                <p><strong>æ­¥éª¤8:</strong> æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—ç¡®è®¤å®Œå…¨åœæ­¢</p>
            </div>

            <button class="test-button" onclick="openMainApp()">
                ğŸ  æ‰“å¼€ä¸»åº”ç”¨æµ‹è¯•
            </button>
            
            <button class="test-button secondary" onclick="openConsole()">
                ğŸ” æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—
            </button>
        </div>

        <div class="test-section">
            <h3>âœ… é¢„æœŸä¿®å¤æ•ˆæœ</h3>
            <ul class="feature-list">
                <li><span class="check">âœ“</span> ç‚¹å‡»å…³é—­æŒ‰é’®åè¯­éŸ³ç›‘å¬ç«‹å³åœæ­¢</li>
                <li><span class="check">âœ“</span> ä¸å†å‡ºç°"å‡å…³é—­"ç°è±¡</li>
                <li><span class="check">âœ“</span> çŠ¶æ€æ˜¾ç¤ºä¸å®é™…åŠŸèƒ½ä¿æŒä¸€è‡´</li>
                <li><span class="check">âœ“</span> è¯­éŸ³è¯†åˆ«å®Œå…¨åœæ­¢ï¼Œä¸ä¼šè‡ªåŠ¨é‡å¯</li>
                <li><span class="check">âœ“</span> æ‰€æœ‰ç›¸å…³èµ„æºè¢«æ­£ç¡®æ¸…ç†</li>
                <li><span class="check">âœ“</span> æ§åˆ¶å°æ˜¾ç¤ºæ˜ç¡®çš„åœæ­¢æ—¥å¿—</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>ğŸ” æŠ€æœ¯ç»†èŠ‚</h3>
            <p><strong>ä¿®å¤çš„å…³é”®ä»£ç å˜æ›´:</strong></p>
            
            <h4>1. stopListeningå‡½æ•°å¢å¼º:</h4>
            <pre style="background: #f3f4f6; padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 14px;">
const stopListening = () => {
  console.log('[CanvasVoiceController] å¼€å§‹åœæ­¢è¯­éŸ³ç›‘å¬...');
  
  // ç«‹å³è®¾ç½®çŠ¶æ€ï¼Œé˜²æ­¢é‡å¯
  setIsListening(false);
  setIsProcessing(false);
  
  // åœæ­¢æµè§ˆå™¨è¯­éŸ³è¯†åˆ«
  if (recognitionRef.current) {
    try {
      recognitionRef.current.stop();
      console.log('[CanvasVoiceController] æµè§ˆå™¨è¯­éŸ³è¯†åˆ«å·²åœæ­¢');
    } catch (error) {
      console.error('[CanvasVoiceController] åœæ­¢è¯­éŸ³è¯†åˆ«æ—¶å‡ºé”™:', error);
    }
  }
  
  // æ¸…ç†é”™è¯¯è®¡æ•°å’ŒçŠ¶æ€
  setErrorCount(0);
  setError('');
  
  console.log('[CanvasVoiceController] âœ… è¯­éŸ³ç›‘å¬å·²å®Œå…¨åœæ­¢');
};</pre>

            <h4>2. useEffectå¼ºåŒ–ç›‘å¬:</h4>
            <pre style="background: #f3f4f6; padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 14px;">
} else if (!isActive && (isListening || realtimeSession.isConnected)) {
  console.log('[CanvasVoiceController] è¯­éŸ³æ§åˆ¶å…³é—­ï¼Œå¼ºåˆ¶åœæ­¢ç›‘å¬');
  
  // ç«‹å³è®¾ç½®çŠ¶æ€
  setIsListening(false);
  setIsProcessing(false);
  setError('');
  
  // å¼ºåˆ¶åœæ­¢è¯­éŸ³è¯†åˆ«
  if (recognitionRef.current) {
    try {
      recognitionRef.current.stop();
      // æ¸…é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œé˜²æ­¢onendè§¦å‘é‡å¯
      recognitionRef.current.onend = null;
      recognitionRef.current.onerror = null;
      recognitionRef.current.onresult = null;
      console.log('[CanvasVoiceController] å¼ºåˆ¶åœæ­¢å¹¶æ¸…ç†è¯­éŸ³è¯†åˆ«');
    } catch (error) {
      console.error('[CanvasVoiceController] å¼ºåˆ¶åœæ­¢è¯­éŸ³è¯†åˆ«æ—¶å‡ºé”™:', error);
    }
  }
  
  // è°ƒç”¨å®Œæ•´çš„åœæ­¢å‡½æ•°
  stopListening();
}</pre>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š éªŒè¯æ¸…å•</h3>
            <p>æµ‹è¯•æ—¶è¯·ç¡®è®¤ä»¥ä¸‹å„é¡¹:</p>
            <ul class="feature-list">
                <li><span class="check">â–¡</span> è¯­éŸ³æ§åˆ¶æŒ‰é’®çŠ¶æ€æ­£ç¡®åˆ‡æ¢</li>
                <li><span class="check">â–¡</span> å…³é—­åä¸å†å“åº”è¯­éŸ³è¾“å…¥</li>
                <li><span class="check">â–¡</span> æ§åˆ¶å°æ˜¾ç¤º"è¯­éŸ³ç›‘å¬å·²å®Œå…¨åœæ­¢"</li>
                <li><span class="check">â–¡</span> æ²¡æœ‰è‡ªåŠ¨é‡å¯çš„æ—¥å¿—ä¿¡æ¯</li>
                <li><span class="check">â–¡</span> éº¦å…‹é£æƒé™æŒ‡ç¤ºå™¨æ­£ç¡®æ˜¾ç¤º</li>
                <li><span class="check">â–¡</span> é‡æ–°æ¿€æ´»åŠŸèƒ½æ­£å¸¸å·¥ä½œ</li>
            </ul>
        </div>
    </div>

    <script>
        function openMainApp() {
            // æ‰“å¼€ä¸»åº”ç”¨
            window.open('http://localhost:3005/', '_blank');
        }

        function openConsole() {
            alert('è¯·æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œç„¶åæŸ¥çœ‹Consoleæ ‡ç­¾é¡µçš„æ—¥å¿—è¾“å‡º');
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„çŠ¶æ€æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            console.log('è¯­éŸ³æ§åˆ¶ä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('å¼€å‘æœåŠ¡å™¨åœ°å€: http://localhost:3005/');
            console.log('è¯·æŒ‰ç…§æµ‹è¯•æ­¥éª¤éªŒè¯ä¿®å¤æ•ˆæœ');
        });
    </script>
</body>
</html>