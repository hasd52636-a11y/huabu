<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ›å»ºæµ‹è¯•æ•°æ®</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .btn {
            display: inline-block;
            padding: 1rem 2rem;
            margin: 0.5rem;
            background: #3b82f6;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s;
            width: 100%;
            text-align: center;
        }
        
        .btn:hover {
            background: #2563eb;
        }
        
        .btn.success {
            background: #10b981;
        }
        
        .btn.success:hover {
            background: #059669;
        }
        
        .status {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 6px;
            font-size: 0.875rem;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        
        .data-preview {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            max-height: 300px;
            overflow-y: auto;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ åˆ›å»ºæµ‹è¯•æ•°æ®</h1>
            <p>ä¸ºåˆ†äº«æŸ¥çœ‹å™¨åˆ›å»ºå¿…è¦çš„æµ‹è¯•æ•°æ®</p>
        </div>

        <div id="status" class="status info">
            ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ›å»ºæµ‹è¯•æ•°æ®
        </div>

        <button onclick="createTestData()" class="btn success">
            ğŸ“‹ åˆ›å»ºé—®é¢˜åˆ†äº«IDçš„æµ‹è¯•æ•°æ®
        </button>

        <button onclick="createNormalTestData()" class="btn">
            ğŸ“„ åˆ›å»ºæ­£å¸¸åˆ†äº«IDçš„æµ‹è¯•æ•°æ®
        </button>

        <button onclick="showCurrentData()" class="btn">
            ğŸ‘ï¸ æŸ¥çœ‹å½“å‰æ•°æ®
        </button>

        <button onclick="clearAllData()" class="btn" style="background: #ef4444;">
            ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®
        </button>

        <div id="dataPreview" class="data-preview" style="display: none;"></div>

        <div style="margin-top: 2rem; text-align: center;">
            <h3>æµ‹è¯•é“¾æ¥</h3>
            <a href="/?watch=share-1769056688844-v3iise" target="_blank" class="btn">
                ğŸ”— æµ‹è¯•é—®é¢˜åˆ†äº«ID
            </a>
            <a href="/?watch=test-share-123" target="_blank" class="btn">
                ğŸ”— æµ‹è¯•æ­£å¸¸åˆ†äº«ID
            </a>
        </div>
    </div>

    <script>
        const PROBLEM_SHARE_ID = 'share-1769056688844-v3iise';
        const NORMAL_SHARE_ID = 'test-share-123';

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.innerHTML = message;
        }

        function createTestData() {
            try {
                const testSession = {
                    id: PROBLEM_SHARE_ID,
                    hostId: "demo-host-1769059789815",
                    title: "æ¼”ç¤ºåˆ†äº«ä¼šè¯ - å¤šç§å†…å®¹ç±»å‹",
                    createdAt: 1769056189815,
                    lastUpdate: Date.now(),
                    canvasState: {
                        blocks: [
                            {
                                id: "title-block",
                                type: "text",
                                x: 100,
                                y: 100,
                                width: 500,
                                height: 80,
                                content: "ğŸ“‹ åˆ†äº«åŠŸèƒ½æ¼”ç¤ºç”»å¸ƒ",
                                number: 1
                            },
                            {
                                id: "desc-block",
                                type: "text",
                                x: 100,
                                y: 200,
                                width: 400,
                                height: 120,
                                content: "è¿™ä¸ªåˆ†äº«ä¼šè¯åŒ…å«å¤šç§ç±»å‹çš„å†…å®¹å—ï¼š\\nâ€¢ æ–‡æœ¬å—\\nâ€¢ å›¾ç‰‡å—ï¼ˆå ä½ç¬¦ï¼‰\\nâ€¢ è§†é¢‘å—ï¼ˆå ä½ç¬¦ï¼‰",
                                number: 2
                            },
                            {
                                id: "image-placeholder",
                                type: "image",
                                x: 550,
                                y: 200,
                                width: 200,
                                height: 150,
                                content: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuWbvueJh+WNoOS9jeespzwvdGV4dD48L3N2Zz4=",
                                number: 3
                            },
                            {
                                id: "status-block",
                                type: "text",
                                x: 100,
                                y: 380,
                                width: 650,
                                height: 60,
                                content: "âœ… åˆ†äº«åŠŸèƒ½çŠ¶æ€ï¼šæ­£å¸¸è¿è¡Œ | è§‚ä¼—æ•°ï¼š0 | æœ€åæ›´æ–°ï¼š" + new Date().toLocaleString(),
                                number: 4
                            }
                        ],
                        connections: [],
                        zoom: 1,
                        pan: { x: 0, y: 0 }
                    },
                    viewers: [
                        {
                            id: "user-1769059794823-in79",
                            joinTime: 1769059794823,
                            lastSeen: Date.now(),
                            connectionType: "polling",
                            userAgent: navigator.userAgent
                        }
                    ],
                    isActive: true,
                    connectionMode: {
                        type: "polling",
                        priority: 2,
                        config: {
                            pollInterval: 1000,
                            timeout: 10000,
                            retryAttempts: 5
                        }
                    },
                    quality: {
                        level: "excellent",
                        latency: 80,
                        bandwidth: 1500,
                        stability: 0.98,
                        lastMeasured: Date.now()
                    },
                    settings: {
                        maxViewers: 20,
                        autoReconnect: true,
                        compressionEnabled: false,
                        updateThrottle: 300,
                        qualityAdaptive: true
                    }
                };

                const sessionKey = `share-session-${PROBLEM_SHARE_ID}`;
                localStorage.setItem(sessionKey, JSON.stringify(testSession));
                
                updateStatus(`âœ… æˆåŠŸåˆ›å»ºé—®é¢˜åˆ†äº«IDçš„æµ‹è¯•æ•°æ®ï¼<br>
                    <strong>åˆ†äº«ID:</strong> ${PROBLEM_SHARE_ID}<br>
                    <strong>æ¨¡å—æ•°é‡:</strong> ${testSession.canvasState.blocks.length}<br>
                    <strong>åˆ›å»ºæ—¶é—´:</strong> ${new Date().toLocaleString()}<br>
                    ç°åœ¨å¯ä»¥æµ‹è¯•æŸ¥çœ‹å™¨äº†ï¼`, 'success');
                
                console.log('æµ‹è¯•æ•°æ®å·²åˆ›å»º:', testSession);
                
            } catch (error) {
                updateStatus(`âŒ åˆ›å»ºæµ‹è¯•æ•°æ®å¤±è´¥: ${error.message}`, 'error');
                console.error('åˆ›å»ºæµ‹è¯•æ•°æ®å¤±è´¥:', error);
            }
        }

        function createNormalTestData() {
            try {
                const normalSession = {
                    id: NORMAL_SHARE_ID,
                    hostId: "normal-host-" + Date.now(),
                    title: "æ­£å¸¸åˆ†äº«ä¼šè¯æµ‹è¯•",
                    createdAt: Date.now(),
                    lastUpdate: Date.now(),
                    canvasState: {
                        blocks: [
                            {
                                id: "normal-block-1",
                                type: "text",
                                x: 50,
                                y: 50,
                                width: 300,
                                height: 100,
                                content: "è¿™æ˜¯ä¸€ä¸ªæ­£å¸¸çš„åˆ†äº«ä¼šè¯\\nç”¨äºå¯¹æ¯”æµ‹è¯•",
                                number: 1
                            },
                            {
                                id: "normal-block-2",
                                type: "text",
                                x: 400,
                                y: 50,
                                width: 300,
                                height: 100,
                                content: "æ­£å¸¸ä¼šè¯åº”è¯¥ä½¿ç”¨å®æ—¶æŸ¥çœ‹å™¨\\nè€Œä¸æ˜¯éš”ç¦»æŸ¥çœ‹å™¨",
                                number: 2
                            }
                        ],
                        connections: [],
                        zoom: 1,
                        pan: { x: 0, y: 0 }
                    },
                    viewers: [],
                    isActive: true
                };

                const sessionKey = `share-session-${NORMAL_SHARE_ID}`;
                localStorage.setItem(sessionKey, JSON.stringify(normalSession));
                
                updateStatus(`âœ… æˆåŠŸåˆ›å»ºæ­£å¸¸åˆ†äº«IDçš„æµ‹è¯•æ•°æ®ï¼<br>
                    <strong>åˆ†äº«ID:</strong> ${NORMAL_SHARE_ID}<br>
                    <strong>æ¨¡å—æ•°é‡:</strong> ${normalSession.canvasState.blocks.length}<br>
                    ç”¨äºå¯¹æ¯”æµ‹è¯•`, 'success');
                
            } catch (error) {
                updateStatus(`âŒ åˆ›å»ºæ­£å¸¸æµ‹è¯•æ•°æ®å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function showCurrentData() {
            const preview = document.getElementById('dataPreview');
            let content = '<h4>å½“å‰localStorageä¸­çš„åˆ†äº«æ•°æ®:</h4>';
            
            let hasData = false;
            
            // æ£€æŸ¥é—®é¢˜åˆ†äº«ID
            const problemData = localStorage.getItem(`share-session-${PROBLEM_SHARE_ID}`);
            if (problemData) {
                hasData = true;
                content += `<h5>é—®é¢˜åˆ†äº«ID (${PROBLEM_SHARE_ID}):</h5>`;
                content += `<pre>${JSON.stringify(JSON.parse(problemData), null, 2)}</pre>`;
            }
            
            // æ£€æŸ¥æ­£å¸¸åˆ†äº«ID
            const normalData = localStorage.getItem(`share-session-${NORMAL_SHARE_ID}`);
            if (normalData) {
                hasData = true;
                content += `<h5>æ­£å¸¸åˆ†äº«ID (${NORMAL_SHARE_ID}):</h5>`;
                content += `<pre>${JSON.stringify(JSON.parse(normalData), null, 2)}</pre>`;
            }
            
            if (!hasData) {
                content += '<p style="color: #ef4444;">âŒ æ²¡æœ‰æ‰¾åˆ°åˆ†äº«æ•°æ®ï¼Œè¯·å…ˆåˆ›å»ºæµ‹è¯•æ•°æ®</p>';
            }
            
            preview.innerHTML = content;
            preview.style.display = 'block';
            
            updateStatus(hasData ? 'âœ… æ•°æ®æ˜¾ç¤ºå®Œæˆ' : 'âŒ æ²¡æœ‰æ‰¾åˆ°æ•°æ®', hasData ? 'success' : 'error');
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æµ‹è¯•æ•°æ®å—ï¼Ÿ')) {
                localStorage.removeItem(`share-session-${PROBLEM_SHARE_ID}`);
                localStorage.removeItem(`share-session-${NORMAL_SHARE_ID}`);
                
                const preview = document.getElementById('dataPreview');
                preview.style.display = 'none';
                
                updateStatus('âœ… æ‰€æœ‰æµ‹è¯•æ•°æ®å·²æ¸…é™¤', 'success');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç°æœ‰æ•°æ®
        window.onload = function() {
            const problemData = localStorage.getItem(`share-session-${PROBLEM_SHARE_ID}`);
            const normalData = localStorage.getItem(`share-session-${NORMAL_SHARE_ID}`);
            
            if (problemData || normalData) {
                updateStatus('âœ… æ£€æµ‹åˆ°ç°æœ‰æµ‹è¯•æ•°æ®ï¼Œå¯ä»¥ç›´æ¥æµ‹è¯•', 'success');
            } else {
                updateStatus('â„¹ï¸ æ²¡æœ‰æ£€æµ‹åˆ°æµ‹è¯•æ•°æ®ï¼Œè¯·å…ˆåˆ›å»º', 'info');
            }
        };
    </script>
</body>
</html>