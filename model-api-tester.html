<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥é©¬APIæ¨¡å‹é…ç½®æµ‹è¯•å·¥å…· - å®Œæ•´æ¨¡å‹æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .api-config {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .config-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .config-group {
            display: flex;
            flex-direction: column;
        }

        .config-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .config-group input, .config-group select {
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .config-group input:focus, .config-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .test-section {
            margin-bottom: 30px;
        }

        .test-section h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .test-card {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            min-height: 200px;
        }

        .test-card.success {
            border-color: #28a745;
            background: linear-gradient(135deg, #f8fff9 0%, #ffffff 100%);
        }

        .test-card.error {
            border-color: #dc3545;
            background: linear-gradient(135deg, #fff8f8 0%, #ffffff 100%);
        }

        .test-card.testing {
            border-color: #007bff;
            background: linear-gradient(135deg, #f8fbff 0%, #ffffff 100%);
        }

        .test-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .test-card h4 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #333;
        }

        .test-card p {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .test-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .test-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .status {
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
        }

        .status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .status.testing {
            background: #cce5ff;
            color: #004085;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .result-details {
            margin-top: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            border-left: 4px solid #007bff;
        }

        .result-details.error {
            background: #fff5f5;
            border-left-color: #dc3545;
        }

        .result-details.success {
            background: #f0fff4;
            border-left-color: #28a745;
        }

        .overall-status {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .test-all-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 15px;
        }

        .test-all-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
        }

        .clear-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-button:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .config-row {
                grid-template-columns: 1fr;
            }
            
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ç¥é©¬APIæ¨¡å‹é…ç½®æµ‹è¯•å·¥å…·</h1>
            <p>åŸºäºShenma APIæ–‡æ¡£çš„å®Œæ•´æ¨¡å‹æµ‹è¯• - æµ‹è¯•æ‰€æœ‰æ–‡æœ¬ã€å›¾åƒã€è§†é¢‘å’Œå¤šæ¨¡æ€AIæ¨¡å‹</p>
        </div>

        <div class="content">
            <!-- APIé…ç½®åŒºåŸŸ -->
            <div class="api-config">
                <h3>ğŸ”§ APIé…ç½®</h3>
                <div class="config-row">
                    <div class="config-group">
                        <label for="apiKey">APIå¯†é’¥</label>
                        <input type="password" id="apiKey" placeholder="è¾“å…¥æ‚¨çš„APIå¯†é’¥" value="sk-jB7cXgP74ykqSS1QRkRZI0WOtwkkZYRnNwwWNp1xQQpwbNVB">
                    </div>
                    <div class="config-group">
                        <label for="baseUrl">APIåŸºç¡€URL</label>
                        <input type="text" id="baseUrl" placeholder="https://hk-api.gptbest.vip" value="https://hk-api.gptbest.vip">
                    </div>
                </div>
                <div class="config-row">
                    <div class="config-group">
                        <label for="provider">æä¾›å•†</label>
                        <select id="provider">
                            <option value="shenma">ç¥é©¬AI (Shenma)</option>
                            <option value="google">Google (Gemini)</option>
                            <option value="zhipu">æ™ºè°±AI (Zhipu)</option>
                            <option value="openai">OpenAIå…¼å®¹</option>
                        </select>
                    </div>
                    <div class="config-group">
                        <label for="timeout">è¯·æ±‚è¶…æ—¶ (ç§’)</label>
                        <input type="number" id="timeout" value="30" min="5" max="120">
                    </div>
                </div>
            </div>

            <!-- æ•´ä½“çŠ¶æ€ -->
            <div class="overall-status">
                <h3>ğŸ“Š æµ‹è¯•æ¦‚è§ˆ</h3>
                <p id="overallStatus">å‡†å¤‡å¼€å§‹æµ‹è¯•...</p>
                <div style="margin-top: 15px;">
                    <button class="test-all-button" onclick="testAllModels()">
                        <span id="testAllText">ğŸ§ª æµ‹è¯•æ‰€æœ‰æ¨¡å‹</span>
                    </button>
                    <button class="clear-button" onclick="clearAllResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
                    <button class="clear-button" onclick="exportErrorReport()" style="background: #dc3545; margin-left: 10px;">ğŸ“‹ å¯¼å‡ºé”™è¯¯æŠ¥å‘Š</button>
                </div>
            </div>

            <!-- æ–‡æœ¬æ¨¡å‹æµ‹è¯• -->
            <div class="test-section">
                <h3>ğŸ’¬ æ–‡æœ¬ç”Ÿæˆæ¨¡å‹</h3>
                <div class="test-grid" id="textModels">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- å›¾åƒæ¨¡å‹æµ‹è¯• -->
            <div class="test-section">
                <h3>ğŸ¨ å›¾åƒç”Ÿæˆæ¨¡å‹</h3>
                <div class="test-grid" id="imageModels">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- è§†é¢‘æ¨¡å‹æµ‹è¯• -->
            <div class="test-section">
                <h3>ğŸ¬ è§†é¢‘ç”Ÿæˆæ¨¡å‹</h3>
                <div class="test-grid" id="videoModels">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- å¤šæ¨¡æ€æ¨¡å‹æµ‹è¯• -->
            <div class="test-section">
                <h3>ğŸ”„ å¤šæ¨¡æ€æ¨¡å‹</h3>
                <div class="test-grid" id="multimodalModels">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡å‹é…ç½® - åŸºäºShenma APIæ–‡æ¡£çš„å®Œæ•´æ¨¡å‹åˆ—è¡¨
        const modelConfigs = {
            // æ–‡æœ¬ç”Ÿæˆæ¨¡å‹ (Geminiç³»åˆ— - æ ¹æ®APIæ–‡æ¡£)
            text: [
                { id: 'gemini-2.0-flash-exp', name: 'Gemini 2.0 Flash Experimental', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'æœ€æ–°Geminiæ¨¡å‹ï¼Œæ”¯æŒæ€ç»´é“¾å’Œå¤šæ¨¡æ€' },
                { id: 'gemini-1.5-pro', name: 'Gemini 1.5 Pro', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'é«˜çº§Geminiæ¨¡å‹ï¼Œé€‚åˆå¤æ‚ä»»åŠ¡' },
                { id: 'gemini-2.5-pro', name: 'Gemini 2.5 Pro', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Gemini 2.5ä¸“ä¸šç‰ˆ' },
                { id: 'gemini-2.5-pro-preview-05-06', name: 'Gemini 2.5 Pro Preview', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Gemini 2.5é¢„è§ˆç‰ˆ' },
                { id: 'gemini-3-flash-preview', name: 'Gemini 3 Flash Preview', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Gemini 3å¿«é€Ÿç‰ˆé¢„è§ˆ' },
                { id: 'gemini-3-flash-preview-nothinking', name: 'Gemini 3 Flash (No Thinking)', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Gemini 3å¿«é€Ÿç‰ˆï¼Œæ— æ€ç»´é“¾' },
                { id: 'gemini-3-pro-preview-thinking', name: 'Gemini 3 Pro Thinking', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Gemini 3ä¸“ä¸šç‰ˆï¼Œæ”¯æŒæ€ç»´é“¾' },
                { id: 'gpt-4o', name: 'GPT-4o', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'OpenAI GPT-4oæ¨¡å‹' },
                { id: 'gpt-4o-mini', name: 'GPT-4o Mini', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'GPT-4oè½»é‡ç‰ˆ' },
                { id: 'claude-3-sonnet', name: 'Claude 3 Sonnet', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Anthropic Claude 3 Sonnet' }
            ],
            
            // å›¾åƒç”Ÿæˆæ¨¡å‹ (æ ¹æ®APIæ–‡æ¡£)
            image: [
                { id: 'nano-banana-hd', name: 'Nano Banana HD', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'é«˜æ¸…å›¾åƒç”Ÿæˆæ¨¡å‹' },
                { id: 'nano-banana', name: 'Nano Banana', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'åŸºç¡€å›¾åƒç”Ÿæˆæ¨¡å‹' },
                { id: 'nano-banana-2', name: 'Nano Banana 2', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'å›¾åƒç”Ÿæˆæ¨¡å‹v2' },
                { id: 'flux-dev', name: 'Flux Dev', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Fluxå¼€å‘ç‰ˆå›¾åƒç”Ÿæˆ' },
                { id: 'flux-pro', name: 'Flux Pro', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Fluxä¸“ä¸šç‰ˆå›¾åƒç”Ÿæˆ' },
                { id: 'flux-kontext-pro', name: 'Flux Kontext Pro', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Flux Kontextä¸“ä¸šç‰ˆ' },
                { id: 'flux-kontext-max', name: 'Flux Kontext Max', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Flux Kontextæœ€å¤§ç‰ˆ' },
                { id: 'dall-e-3', name: 'DALL-E 3', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'OpenAI DALL-E 3' },
                { id: 'dall-e-2', name: 'DALL-E 2', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'OpenAI DALL-E 2' },
                { id: 'recraftv3', name: 'Recraft V3', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Recraft V3å›¾åƒç”Ÿæˆ' },
                { id: 'byteedit-v2.0', name: 'ByteEdit v2.0', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'ByteEditå›¾åƒç¼–è¾‘v2.0' },
                { id: 'byteedit-enhance', name: 'ByteEdit Enhance', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'ByteEditå›¾åƒå¢å¼º' },
                { id: 'gemini-2.5-flash-image-preview', name: 'Gemini 2.5 Flash Image', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Geminiå›¾åƒç”Ÿæˆé¢„è§ˆç‰ˆ' }
            ],
            
            // è§†é¢‘ç”Ÿæˆæ¨¡å‹ (æ ¹æ®APIæ–‡æ¡£)
            video: [
                // Soraç³»åˆ— - Chatæ ¼å¼å…¼å®¹
                { id: 'sora_video2', name: 'Sora Video 2', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Soraè§†é¢‘ç”Ÿæˆv2' },
                { id: 'sora_video2-portrait', name: 'Sora Video 2 Portrait', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Soraç«–å±è§†é¢‘ç”Ÿæˆ' },
                { id: 'sora_video2-landscape', name: 'Sora Video 2 Landscape', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Soraæ¨ªå±è§†é¢‘ç”Ÿæˆ' },
                { id: 'sora_video2-portrait-hd', name: 'Sora Video 2 Portrait HD', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Soraç«–å±é«˜æ¸…è§†é¢‘' },
                { id: 'sora_video2-portrait-15s', name: 'Sora Video 2 Portrait 15s', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Soraç«–å±15ç§’è§†é¢‘' },
                { id: 'sora_video2-portrait-hd-15s', name: 'Sora Video 2 Portrait HD 15s', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'Soraç«–å±é«˜æ¸…15ç§’è§†é¢‘' },
                
                // Sora 2ç³»åˆ— - ç»Ÿä¸€æ ¼å¼æ¥å£
                { id: 'sora-2', name: 'Sora 2', provider: 'shenma', endpoint: '/v2/videos/generations', description: 'Sora 2è§†é¢‘ç”Ÿæˆ' },
                { id: 'sora-2-pro', name: 'Sora 2 Pro', provider: 'shenma', endpoint: '/v2/videos/generations', description: 'Sora 2ä¸“ä¸šç‰ˆï¼Œæ”¯æŒHDå’Œ25ç§’' },
                
                // Veoç³»åˆ— - Googleè§†é¢‘æ¨¡å‹
                { id: 'veo3', name: 'Veo 3', provider: 'shenma', endpoint: '/v2/videos/generations', description: 'Google Veo 3è§†é¢‘ç”Ÿæˆ' },
                { id: 'veo3-fast', name: 'Veo 3 Fast', provider: 'shenma', endpoint: '/v2/videos/generations', description: 'Veo 3å¿«é€Ÿç‰ˆ' },
                { id: 'veo3-pro', name: 'Veo 3 Pro', provider: 'shenma', endpoint: '/v2/videos/generations', description: 'Veo 3ä¸“ä¸šç‰ˆ' },
                { id: 'veo3-pro-frames', name: 'Veo 3 Pro Frames', provider: 'shenma', endpoint: '/v2/videos/generations', description: 'Veo 3ä¸“ä¸šç‰ˆï¼Œæ”¯æŒå›¾ç”Ÿè§†é¢‘' },
                { id: 'veo3.1', name: 'Veo 3.1', provider: 'shenma', endpoint: '/v2/videos/generations', description: 'Googleæœ€æ–°Veo 3.1ï¼Œæ”¯æŒéŸ³é¢‘ç”Ÿæˆ' },
                { id: 'veo3.1-pro', name: 'Veo 3.1 Pro', provider: 'shenma', endpoint: '/v2/videos/generations', description: 'Veo 3.1ä¸“ä¸šç‰ˆï¼Œè¶…é«˜è´¨é‡' },
                
                // å…¶ä»–è§†é¢‘æ¨¡å‹
                { id: 'wanx2.1-vace-plus', name: 'WanX 2.1 Vace Plus', provider: 'shenma', endpoint: '/v2/videos/generations', description: 'WanXè§†é¢‘ç”Ÿæˆ' },
                { id: 'wan2.2-animate-move', name: 'WanX 2.2 Animate Move', provider: 'shenma', endpoint: '/v2/videos/generations', description: 'WanXåŠ¨ç”»ç§»åŠ¨' },
                { id: 'wan2.2-animate-mix', name: 'WanX 2.2 Animate Mix', provider: 'shenma', endpoint: '/v2/videos/generations', description: 'WanXåŠ¨ç”»æ··åˆ' }
            ],
            
            // å¤šæ¨¡æ€æ¨¡å‹ (æ”¯æŒå›¾åƒ+æ–‡æœ¬)
            multimodal: [
                { id: 'gemini-2.0-flash-exp', name: 'Gemini 2.0 Flash (å¤šæ¨¡æ€)', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'æ”¯æŒå›¾åƒå’Œè§†é¢‘åˆ†æçš„å¤šæ¨¡æ€æ¨¡å‹' },
                { id: 'gemini-1.5-pro', name: 'Gemini 1.5 Pro (å¤šæ¨¡æ€)', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'é«˜çº§å¤šæ¨¡æ€åˆ†æèƒ½åŠ›' },
                { id: 'gemini-2.5-pro-preview-05-06', name: 'Gemini 2.5 Pro (å¤šæ¨¡æ€)', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'æ”¯æŒè§†é¢‘åˆ†æçš„å¤šæ¨¡æ€æ¨¡å‹' },
                { id: 'gpt-4o', name: 'GPT-4o (å¤šæ¨¡æ€)', provider: 'shenma', endpoint: '/v1/chat/completions', description: 'OpenAIå¤šæ¨¡æ€æ¨¡å‹' }
            ]
        };

        // æµ‹è¯•ç»“æœå­˜å‚¨
        let testResults = {};

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            renderModelCards();
            updateOverallStatus();
        }

        // æ¸²æŸ“æ¨¡å‹å¡ç‰‡
        function renderModelCards() {
            // æ¸²æŸ“æ‰€æœ‰æ¨¡å‹ç±»åˆ«
            ['text', 'image', 'video', 'multimodal'].forEach(category => {
                const container = document.getElementById(category + 'Models');
                if (!container) return;
                
                container.innerHTML = '';
                
                if (modelConfigs[category] && modelConfigs[category].length > 0) {
                    modelConfigs[category].forEach(model => {
                        const card = createModelCard(model, category);
                        container.appendChild(card);
                    });
                } else {
                    // æ˜¾ç¤ºæ— å¯ç”¨æ¨¡å‹çš„æç¤º
                    const noModelsCard = document.createElement('div');
                    noModelsCard.className = 'test-card';
                    noModelsCard.innerHTML = `
                        <h4>æš‚æ— å¯ç”¨æ¨¡å‹</h4>
                        <p>è¯¥ç±»åˆ«ä¸‹çš„æ¨¡å‹éœ€è¦é¢å¤–é…ç½®æˆ–æƒé™</p>
                        <div class="status pending">ç­‰å¾…é…ç½®</div>
                    `;
                    container.appendChild(noModelsCard);
                }
            });
        }

        // åˆ›å»ºæ¨¡å‹å¡ç‰‡
        function createModelCard(model, category) {
            const card = document.createElement('div');
            card.className = 'test-card';
            card.innerHTML = `
                <h4>${model.name}</h4>
                <p><strong>æ¨¡å‹ID:</strong> ${model.id}<br>
                   <strong>æä¾›å•†:</strong> ${model.provider}<br>
                   <strong>ç«¯ç‚¹:</strong> ${model.endpoint}<br>
                   <strong>æè¿°:</strong> ${model.description || 'æ— æè¿°'}</p>
                <button class="test-button" onclick="testModel('${model.id}', '${category}')">
                    <span id="btn-${model.id}">ğŸ§ª æµ‹è¯•è¿æ¥</span>
                </button>
                <div class="status pending" id="status-${model.id}">ç­‰å¾…æµ‹è¯•</div>
                <div class="result-details" id="details-${model.id}" style="display: none;"></div>
            `;
            return card;
        }

        // æµ‹è¯•å•ä¸ªæ¨¡å‹
        async function testModel(modelId, category) {
            const model = findModelById(modelId);
            if (!model) return;

            const statusEl = document.getElementById(`status-${modelId}`);
            const btnEl = document.getElementById(`btn-${modelId}`);
            const detailsEl = document.getElementById(`details-${modelId}`);

            // æ›´æ–°çŠ¶æ€ä¸ºæµ‹è¯•ä¸­
            statusEl.className = 'status testing';
            statusEl.textContent = 'æµ‹è¯•ä¸­...';
            btnEl.innerHTML = '<span class="loading"></span>æµ‹è¯•ä¸­';
            detailsEl.style.display = 'none';
            
            // æ›´æ–°å¡ç‰‡æ ·å¼
            const card = statusEl.closest('.test-card');
            card.className = 'test-card testing';

            try {
                const result = await performModelTest(model, category);
                testResults[modelId] = result;

                if (result.success) {
                    statusEl.className = 'status success';
                    statusEl.textContent = `âœ… è¿æ¥æˆåŠŸ (${result.responseTime}ms)`;
                    
                    // æ›´æ–°å¡ç‰‡æ ·å¼
                    const card = statusEl.closest('.test-card');
                    card.className = 'test-card success';
                    
                    detailsEl.className = 'result-details success';
                    detailsEl.innerHTML = `
                        <div style="font-weight: bold; color: #28a745; margin-bottom: 10px;">âœ… æµ‹è¯•æˆåŠŸ</div>
                        <div><strong>å“åº”æ—¶é—´:</strong> ${result.responseTime}ms</div>
                        <div><strong>å“åº”å†…å®¹:</strong> ${result.response || 'æˆåŠŸ'}</div>
                        <div><strong>ç«¯ç‚¹:</strong> ${model.endpoint}</div>
                        <div><strong>æä¾›å•†:</strong> ${model.provider}</div>
                        <div><strong>æ¨¡å‹ID:</strong> ${model.id}</div>
                    `;
                } else {
                    statusEl.className = 'status error';
                    statusEl.textContent = 'âŒ è¿æ¥å¤±è´¥';
                    
                    // æ›´æ–°å¡ç‰‡æ ·å¼
                    const card = statusEl.closest('.test-card');
                    card.className = 'test-card error';
                    
                    // è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯åˆ†æ
                    let errorAnalysis = '';
                    let troubleshooting = '';
                    
                    if (result.statusCode === 401) {
                        errorAnalysis = 'APIå¯†é’¥æ— æƒé™è®¿é—®æ­¤æ¨¡å‹';
                        troubleshooting = 'è¯·æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®ï¼Œæˆ–è”ç³»æœåŠ¡æä¾›å•†ç¡®è®¤æ¨¡å‹è®¿é—®æƒé™';
                    } else if (result.statusCode === 403) {
                        errorAnalysis = 'æ¨¡å‹éœ€è¦ç‰¹æ®Šæƒé™æˆ–ä»˜è´¹è®¢é˜…';
                        troubleshooting = 'è¯¥æ¨¡å‹å¯èƒ½éœ€è¦ä»˜è´¹è®¢é˜…æˆ–ç‰¹æ®Šæƒé™ï¼Œè¯·è”ç³»æœåŠ¡æä¾›å•†';
                    } else if (result.statusCode === 404) {
                        errorAnalysis = 'æ¨¡å‹IDä¸å­˜åœ¨æˆ–ç«¯ç‚¹è·¯å¾„é”™è¯¯';
                        troubleshooting = 'è¯·æ£€æŸ¥æ¨¡å‹IDæ˜¯å¦æ­£ç¡®ï¼Œæˆ–ç«¯ç‚¹é…ç½®æ˜¯å¦æœ‰è¯¯';
                    } else if (result.statusCode === 429) {
                        errorAnalysis = 'è¯·æ±‚é¢‘ç‡é™åˆ¶æˆ–é…é¢ä¸è¶³';
                        troubleshooting = 'è¯·ç¨åé‡è¯•ï¼Œæˆ–æ£€æŸ¥APIé…é¢æ˜¯å¦å……è¶³';
                    } else if (result.statusCode >= 500) {
                        errorAnalysis = 'æœåŠ¡å™¨é”™è¯¯æˆ–æ¨¡å‹æš‚æ—¶ä¸å¯ç”¨';
                        troubleshooting = 'æœåŠ¡å™¨ç«¯é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•æˆ–è”ç³»æœåŠ¡æä¾›å•†';
                    } else {
                        errorAnalysis = 'æœªçŸ¥é”™è¯¯';
                        troubleshooting = 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIé…ç½®';
                    }
                    
                    detailsEl.className = 'result-details error';
                    detailsEl.innerHTML = `
                        <div style="font-weight: bold; color: #dc3545; margin-bottom: 10px;">âŒ æµ‹è¯•å¤±è´¥</div>
                        <div><strong>çŠ¶æ€ç :</strong> ${result.statusCode || 'N/A'}</div>
                        <div><strong>é”™è¯¯ä¿¡æ¯:</strong> ${result.error}</div>
                        <div><strong>å¯èƒ½åŸå› :</strong> ${errorAnalysis}</div>
                        <div><strong>è§£å†³å»ºè®®:</strong> ${troubleshooting}</div>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #dee2e6;">
                            <div><strong>ç«¯ç‚¹:</strong> ${model.endpoint}</div>
                            <div><strong>æä¾›å•†:</strong> ${model.provider}</div>
                            <div><strong>æ¨¡å‹ID:</strong> ${model.id}</div>
                        </div>
                    `;
                }
                detailsEl.style.display = 'block';
            } catch (error) {
                testResults[modelId] = { success: false, error: error.message };
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ æµ‹è¯•å¼‚å¸¸';
                
                // æ›´æ–°å¡ç‰‡æ ·å¼
                const card = statusEl.closest('.test-card');
                card.className = 'test-card error';
                
                detailsEl.className = 'result-details error';
                detailsEl.innerHTML = `
                    <div style="font-weight: bold; color: #dc3545; margin-bottom: 10px;">âŒ æµ‹è¯•å¼‚å¸¸</div>
                    <div><strong>å¼‚å¸¸ä¿¡æ¯:</strong> ${error.message}</div>
                    <div><strong>å¯èƒ½åŸå› :</strong> ç½‘ç»œè¿æ¥é—®é¢˜æˆ–è¯·æ±‚è¶…æ—¶</div>
                    <div><strong>è§£å†³å»ºè®®:</strong> æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œå¢åŠ è¶…æ—¶æ—¶é—´ï¼Œæˆ–ç¨åé‡è¯•</div>
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #dee2e6;">
                        <div><strong>ç«¯ç‚¹:</strong> ${model.endpoint}</div>
                        <div><strong>æä¾›å•†:</strong> ${model.provider}</div>
                        <div><strong>æ¨¡å‹ID:</strong> ${model.id}</div>
                    </div>
                `;
                detailsEl.style.display = 'block';
            }

            btnEl.innerHTML = 'ğŸ”„ é‡æ–°æµ‹è¯•';
            updateOverallStatus();
        }

        // æ‰§è¡Œæ¨¡å‹æµ‹è¯•
        async function performModelTest(model, category) {
            const apiKey = document.getElementById('apiKey').value;
            const baseUrl = document.getElementById('baseUrl').value;
            const timeout = parseInt(document.getElementById('timeout').value) * 1000;

            if (!apiKey) {
                throw new Error('è¯·è¾“å…¥APIå¯†é’¥');
            }

            const startTime = Date.now();
            let requestBody, endpoint;

            // æ ¹æ®æ¨¡å‹ç±»å‹å’Œç«¯ç‚¹æ„å»ºè¯·æ±‚
            endpoint = `${baseUrl}${model.endpoint}`;

            if (model.endpoint === '/v1/chat/completions') {
                // èŠå¤©æ ¼å¼ - é€‚ç”¨äºæ–‡æœ¬ã€å›¾åƒã€è§†é¢‘ã€å¤šæ¨¡æ€
                if (category === 'text') {
                    requestBody = {
                        model: model.id,
                        messages: [
                            { role: 'user', content: 'Hello, please respond with "API connection successful"' }
                        ],
                        max_tokens: 50,
                        temperature: 0.7
                    };
                } else if (category === 'image') {
                    requestBody = {
                        model: model.id,
                        messages: [
                            { role: 'user', content: 'Generate a simple test image of a cat' }
                        ]
                    };
                } else if (category === 'video') {
                    // è§†é¢‘ç”Ÿæˆä½¿ç”¨èŠå¤©æ ¼å¼ï¼Œåœ¨æç¤ºè¯ä¸­æŒ‡å®šè¦æ±‚
                    let prompt = 'Generate a simple test video';
                    if (model.id.includes('portrait')) {
                        prompt = 'ç«–å± ' + prompt;
                    } else if (model.id.includes('landscape')) {
                        prompt = 'æ¨ªå± ' + prompt;
                    }
                    if (model.id.includes('hd')) {
                        prompt = 'é«˜æ¸… ' + prompt;
                    }
                    if (model.id.includes('15s')) {
                        prompt = '15s ' + prompt;
                    }
                    
                    requestBody = {
                        model: model.id,
                        messages: [
                            { role: 'user', content: prompt }
                        ],
                        stream: false
                    };
                } else if (category === 'multimodal') {
                    // å¤šæ¨¡æ€æµ‹è¯• - å‘é€æ–‡æœ¬è¯·æ±‚
                    requestBody = {
                        model: model.id,
                        messages: [
                            { role: 'user', content: 'Hello, please respond with "Multimodal API connection successful"' }
                        ],
                        max_tokens: 50
                    };
                }
            } else if (model.endpoint === '/v2/videos/generations') {
                // ç»Ÿä¸€æ ¼å¼è§†é¢‘æ¥å£
                requestBody = {
                    prompt: 'A simple test video of a cat',
                    model: model.id
                };
                
                // æ ¹æ®æ¨¡å‹æ·»åŠ ç‰¹å®šå‚æ•°
                if (model.id.includes('veo')) {
                    requestBody.aspect_ratio = '16:9';
                    requestBody.enhance_prompt = false;
                    requestBody.enable_upsample = false;
                } else if (model.id.includes('sora')) {
                    requestBody.aspect_ratio = '16:9';
                    requestBody.duration = '10';
                    requestBody.hd = false;
                }
            } else if (model.endpoint === '/v1/images/generations') {
                // å›¾åƒç”Ÿæˆæ¥å£
                requestBody = {
                    model: model.id,
                    prompt: 'A simple test image of a cat',
                    size: '1024x1024'
                };
            } else if (model.endpoint.includes('/v1beta/models/')) {
                // Geminiå®˜æ–¹æ ¼å¼
                endpoint = `${baseUrl}/v1beta/models/${model.id}:generateContent`;
                requestBody = {
                    contents: [
                        {
                            parts: [
                                { text: 'Hello, please respond with "Gemini API connection successful"' }
                            ]
                        }
                    ],
                    generationConfig: {
                        thinkingConfig: {
                            thinkingBudget: 128,
                            includeThoughts: true
                        }
                    }
                };
            } else {
                throw new Error('æœªçŸ¥çš„ç«¯ç‚¹ç±»å‹: ' + model.endpoint);
            }

            // å‘é€è¯·æ±‚
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);

            try {
                console.log(`[æµ‹è¯•] è¯·æ±‚ ${model.id}:`, {
                    endpoint,
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey.substring(0, 10)}...`,
                        'Content-Type': 'application/json'
                    },
                    body: requestBody
                });

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                const responseTime = Date.now() - startTime;

                console.log(`[æµ‹è¯•] å“åº” ${model.id}:`, {
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries()),
                    responseTime
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`[æµ‹è¯•] é”™è¯¯è¯¦æƒ… ${model.id}:`, errorText);
                    
                    // å°è¯•è§£æé”™è¯¯JSON
                    let parsedError = errorText;
                    try {
                        const errorJson = JSON.parse(errorText);
                        parsedError = errorJson.error?.message || errorJson.message || errorText;
                    } catch (e) {
                        // ä¿æŒåŸå§‹é”™è¯¯æ–‡æœ¬
                    }
                    
                    return {
                        success: false,
                        error: parsedError,
                        statusCode: response.status,
                        responseTime,
                        endpoint,
                        requestBody
                    };
                }

                const data = await response.json();
                console.log(`[æµ‹è¯•] æˆåŠŸå“åº” ${model.id}:`, data);
                
                let responseContent = '';

                // è§£æå“åº”å†…å®¹
                if (model.endpoint === '/v1/chat/completions') {
                    if (category === 'text' || category === 'multimodal') {
                        responseContent = data.choices?.[0]?.message?.content || 'æ–‡æœ¬ç”ŸæˆæˆåŠŸ';
                    } else if (category === 'image') {
                        // å›¾åƒç”Ÿæˆé€šè¿‡èŠå¤©æ¥å£è¿”å›å›¾åƒURLæˆ–æè¿°
                        responseContent = data.choices?.[0]?.message?.content || 'å›¾åƒç”Ÿæˆè¯·æ±‚æˆåŠŸ';
                    } else if (category === 'video') {
                        // è§†é¢‘ç”Ÿæˆé€šè¿‡èŠå¤©æ¥å£è¿”å›è§†é¢‘URLæˆ–ä»»åŠ¡ID
                        responseContent = data.choices?.[0]?.message?.content || 'è§†é¢‘ç”Ÿæˆè¯·æ±‚æˆåŠŸ';
                    }
                } else if (model.endpoint === '/v2/videos/generations') {
                    responseContent = data.task_id ? `è§†é¢‘ä»»åŠ¡åˆ›å»ºæˆåŠŸ (ID: ${data.task_id})` : 'è§†é¢‘ç”Ÿæˆè¯·æ±‚æˆåŠŸ';
                } else if (model.endpoint === '/v1/images/generations') {
                    responseContent = data.data?.[0]?.url ? 'å›¾åƒç”ŸæˆæˆåŠŸ' : 'å›¾åƒURLè·å–æˆåŠŸ';
                } else if (model.endpoint.includes('generateContent')) {
                    // Geminiå®˜æ–¹æ ¼å¼å“åº”
                    responseContent = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Geminiå“åº”æˆåŠŸ';
                }

                return {
                    success: true,
                    response: responseContent,
                    responseTime,
                    data,
                    endpoint,
                    requestBody
                };

            } catch (error) {
                clearTimeout(timeoutId);
                console.error(`[æµ‹è¯•] å¼‚å¸¸ ${model.id}:`, error);
                
                if (error.name === 'AbortError') {
                    throw new Error(`è¯·æ±‚è¶…æ—¶ (${timeout/1000}ç§’)`);
                }
                throw error;
            }
        }

        // æŸ¥æ‰¾æ¨¡å‹
        function findModelById(modelId) {
            for (const category of Object.keys(modelConfigs)) {
                const model = modelConfigs[category].find(m => m.id === modelId);
                if (model) return model;
            }
            return null;
        }

        // æµ‹è¯•æ‰€æœ‰æ¨¡å‹
        async function testAllModels() {
            const testAllBtn = document.querySelector('.test-all-button');
            const testAllText = document.getElementById('testAllText');
            
            testAllBtn.disabled = true;
            testAllText.innerHTML = '<span class="loading"></span>æµ‹è¯•ä¸­...';

            const allModels = [];
            Object.keys(modelConfigs).forEach(category => {
                modelConfigs[category].forEach(model => {
                    allModels.push({ ...model, category });
                });
            });

            // å¹¶å‘æµ‹è¯•ï¼ˆé™åˆ¶å¹¶å‘æ•°ï¼‰
            const concurrency = 3;
            for (let i = 0; i < allModels.length; i += concurrency) {
                const batch = allModels.slice(i, i + concurrency);
                await Promise.all(
                    batch.map(model => testModel(model.id, model.category))
                );
                // çŸ­æš‚å»¶è¿Ÿé¿å…APIé™æµ
                await new Promise(resolve => setTimeout(resolve, 1000));
            }

            testAllBtn.disabled = false;
            testAllText.textContent = 'ğŸ§ª æµ‹è¯•æ‰€æœ‰æ¨¡å‹';
        }

        // æ¸…é™¤æ‰€æœ‰ç»“æœ
        function clearAllResults() {
            testResults = {};
            
            // é‡ç½®æ‰€æœ‰çŠ¶æ€
            document.querySelectorAll('.status').forEach(el => {
                el.className = 'status pending';
                el.textContent = 'ç­‰å¾…æµ‹è¯•';
            });
            
            // é‡ç½®æ‰€æœ‰å¡ç‰‡æ ·å¼
            document.querySelectorAll('.test-card').forEach(el => {
                el.className = 'test-card';
            });
            
            document.querySelectorAll('.result-details').forEach(el => {
                el.style.display = 'none';
                el.className = 'result-details';
            });
            
            document.querySelectorAll('[id^="btn-"]').forEach(el => {
                el.textContent = 'ğŸ§ª æµ‹è¯•è¿æ¥';
            });

            updateOverallStatus();
        }

        // æ›´æ–°æ•´ä½“çŠ¶æ€
        function updateOverallStatus() {
            const totalTests = Object.keys(modelConfigs).reduce((sum, category) => 
                sum + modelConfigs[category].length, 0
            );
            const completedTests = Object.keys(testResults).length;
            const successfulTests = Object.values(testResults).filter(r => r.success).length;
            const failedTests = completedTests - successfulTests;

            const statusEl = document.getElementById('overallStatus');
            
            if (completedTests === 0) {
                statusEl.textContent = `å‡†å¤‡æµ‹è¯• ${totalTests} ä¸ªæ¨¡å‹...`;
            } else if (completedTests < totalTests) {
                statusEl.textContent = `æµ‹è¯•è¿›åº¦: ${completedTests}/${totalTests} | æˆåŠŸ: ${successfulTests} | å¤±è´¥: ${failedTests}`;
            } else {
                const successRate = ((successfulTests / totalTests) * 100).toFixed(1);
                statusEl.textContent = `æµ‹è¯•å®Œæˆ! æˆåŠŸç‡: ${successRate}% (${successfulTests}/${totalTests})`;
            }
        }

        // å¯¼å‡ºé”™è¯¯æŠ¥å‘Š
        function exportErrorReport() {
            const failedTests = Object.entries(testResults).filter(([id, result]) => !result.success);
            
            if (failedTests.length === 0) {
                alert('æ²¡æœ‰å¤±è´¥çš„æµ‹è¯•éœ€è¦å¯¼å‡º');
                return;
            }

            let report = `# APIæ¨¡å‹æµ‹è¯•é”™è¯¯æŠ¥å‘Š\n\n`;
            report += `ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}\n`;
            report += `APIå¯†é’¥: ${document.getElementById('apiKey').value.substring(0, 10)}...\n`;
            report += `åŸºç¡€URL: ${document.getElementById('baseUrl').value}\n\n`;
            
            report += `## æµ‹è¯•æ¦‚è§ˆ\n`;
            report += `- æ€»æµ‹è¯•æ•°: ${Object.keys(testResults).length}\n`;
            report += `- æˆåŠŸæ•°: ${Object.values(testResults).filter(r => r.success).length}\n`;
            report += `- å¤±è´¥æ•°: ${failedTests.length}\n\n`;

            report += `## å¤±è´¥è¯¦æƒ…\n\n`;
            
            failedTests.forEach(([modelId, result]) => {
                const model = findModelById(modelId);
                report += `### ${model?.name || modelId}\n`;
                report += `- **æ¨¡å‹ID**: ${modelId}\n`;
                report += `- **æä¾›å•†**: ${model?.provider || 'unknown'}\n`;
                report += `- **ç«¯ç‚¹**: ${model?.endpoint || 'unknown'}\n`;
                report += `- **çŠ¶æ€ç **: ${result.statusCode || 'N/A'}\n`;
                report += `- **é”™è¯¯ä¿¡æ¯**: ${result.error || 'N/A'}\n`;
                if (result.endpoint) {
                    report += `- **å®Œæ•´ç«¯ç‚¹**: ${result.endpoint}\n`;
                }
                if (result.requestBody) {
                    report += `- **è¯·æ±‚ä½“**: \`\`\`json\n${JSON.stringify(result.requestBody, null, 2)}\n\`\`\`\n`;
                }
                report += `\n`;
            });

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([report], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `api-test-error-report-${new Date().toISOString().split('T')[0]}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // åŒæ—¶å¤åˆ¶åˆ°å‰ªè´´æ¿
            if (navigator.clipboard) {
                navigator.clipboard.writeText(report).then(() => {
                    alert('é”™è¯¯æŠ¥å‘Šå·²ä¸‹è½½å¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }).catch(() => {
                    alert('é”™è¯¯æŠ¥å‘Šå·²ä¸‹è½½');
                });
            } else {
                alert('é”™è¯¯æŠ¥å‘Šå·²ä¸‹è½½');
            }
        }
    </script>
</body>
</html>

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>