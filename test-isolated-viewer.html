<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éš”ç¦»æŸ¥çœ‹å™¨æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }
        
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            margin: 0.5rem;
            background: #3b82f6;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s;
        }
        
        .btn:hover {
            background: #2563eb;
        }
        
        .btn.success {
            background: #10b981;
        }
        
        .btn.success:hover {
            background: #059669;
        }
        
        .btn.danger {
            background: #ef4444;
        }
        
        .btn.danger:hover {
            background: #dc2626;
        }
        
        .status {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 6px;
            font-size: 0.875rem;
        }
        
        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .code {
            background: #f1f5f9;
            padding: 0.5rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            margin: 0.5rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ éš”ç¦»æŸ¥çœ‹å™¨æµ‹è¯•å·¥å…·</h1>
            <p>æµ‹è¯•æ–°çš„éš”ç¦»æŸ¥çœ‹å™¨æ˜¯å¦èƒ½æ­£ç¡®å¤„ç†é—®é¢˜åˆ†äº«ID</p>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ æµ‹è¯•ä¿¡æ¯</h3>
            <div class="status info">
                <strong>é—®é¢˜åˆ†äº«ID:</strong> share-1769056688844-v3iise<br>
                <strong>æµ‹è¯•ç›®æ ‡:</strong> éªŒè¯éš”ç¦»æŸ¥çœ‹å™¨èƒ½å¦ç¨³å®šæ˜¾ç¤ºå†…å®¹è€Œä¸å´©æºƒ<br>
                <strong>é¢„æœŸç»“æœ:</strong> æ˜¾ç¤ºåˆ†äº«å†…å®¹ï¼Œæ— ç™½å±ï¼Œæ— æµè§ˆå™¨å´©æºƒ
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ§ª æµ‹è¯•æ­¥éª¤</h3>
            
            <div style="margin-bottom: 1rem;">
                <strong>æ­¥éª¤ 1: éªŒè¯æ•°æ®å­˜åœ¨</strong>
                <button onclick="checkSessionData()" class="btn">æ£€æŸ¥ä¼šè¯æ•°æ®</button>
                <div id="dataStatus" class="status info" style="display: none;"></div>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <strong>æ­¥éª¤ 2: æµ‹è¯•éš”ç¦»æŸ¥çœ‹å™¨</strong>
                <a href="/?watch=share-1769056688844-v3iise" class="btn success" target="_blank">
                    ğŸ”— æ‰“å¼€éš”ç¦»æŸ¥çœ‹å™¨
                </a>
                <div class="status info">
                    ç‚¹å‡»ä¸Šæ–¹é“¾æ¥å°†åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€éš”ç¦»æŸ¥çœ‹å™¨
                </div>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <strong>æ­¥éª¤ 3: å¯¹æ¯”æµ‹è¯•</strong>
                <a href="share-viewer.html?watch=share-1769056688844-v3iise" class="btn" target="_blank">
                    ğŸ“„ ç‹¬ç«‹æŸ¥çœ‹å™¨ (å¯¹æ¯”)
                </a>
                <div class="status info">
                    å¯¹æ¯”ç‹¬ç«‹æŸ¥çœ‹å™¨çš„è¡¨ç°
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœè®°å½•</h3>
            <div id="testResults">
                <div class="status info">
                    è¯·æŒ‰é¡ºåºæ‰§è¡Œä¸Šè¿°æµ‹è¯•æ­¥éª¤ï¼Œå¹¶è®°å½•ç»“æœï¼š
                    <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                        <li>éš”ç¦»æŸ¥çœ‹å™¨æ˜¯å¦æ­£å¸¸åŠ è½½ï¼Ÿ</li>
                        <li>æ˜¯å¦æ˜¾ç¤ºäº†åˆ†äº«å†…å®¹ï¼Ÿ</li>
                        <li>æµè§ˆå™¨æ˜¯å¦ä¿æŒç¨³å®šï¼Ÿ</li>
                        <li>æ˜¯å¦å‡ºç°ç™½å±æˆ–å´©æºƒï¼Ÿ</li>
                    </ul>
                </div>
            </div>
            
            <div style="margin-top: 1rem;">
                <button onclick="recordSuccess()" class="btn success">âœ… æµ‹è¯•æˆåŠŸ</button>
                <button onclick="recordFailure()" class="btn danger">âŒ æµ‹è¯•å¤±è´¥</button>
                <button onclick="clearResults()" class="btn">ğŸ”„ æ¸…é™¤è®°å½•</button>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ è°ƒè¯•å·¥å…·</h3>
            <button onclick="showSessionData()" class="btn">æ˜¾ç¤ºä¼šè¯æ•°æ®</button>
            <button onclick="clearSessionData()" class="btn danger">æ¸…é™¤ä¼šè¯æ•°æ®</button>
            <button onclick="createTestData()" class="btn success">åˆ›å»ºæµ‹è¯•æ•°æ®</button>
            
            <div id="debugOutput" style="margin-top: 1rem;"></div>
        </div>
    </div>

    <script>
        const SHARE_ID = 'share-1769056688844-v3iise';
        const SESSION_KEY = `share-session-${SHARE_ID}`;

        function checkSessionData() {
            const dataStatus = document.getElementById('dataStatus');
            const sessionData = localStorage.getItem(SESSION_KEY);
            
            if (sessionData) {
                try {
                    const parsed = JSON.parse(sessionData);
                    dataStatus.className = 'status success';
                    dataStatus.innerHTML = `
                        âœ… ä¼šè¯æ•°æ®å­˜åœ¨<br>
                        <strong>æ ‡é¢˜:</strong> ${parsed.title || 'æœªçŸ¥'}<br>
                        <strong>æ¨¡å—æ•°é‡:</strong> ${parsed.canvasState?.blocks?.length || 0}<br>
                        <strong>åˆ›å»ºæ—¶é—´:</strong> ${new Date(parsed.createdAt).toLocaleString()}<br>
                        <strong>æœ€åæ›´æ–°:</strong> ${new Date(parsed.lastUpdate).toLocaleString()}
                    `;
                } catch (error) {
                    dataStatus.className = 'status error';
                    dataStatus.innerHTML = `âŒ æ•°æ®æ ¼å¼é”™è¯¯: ${error.message}`;
                }
            } else {
                dataStatus.className = 'status error';
                dataStatus.innerHTML = 'âŒ ä¼šè¯æ•°æ®ä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»ºæµ‹è¯•æ•°æ®';
            }
            
            dataStatus.style.display = 'block';
        }

        function showSessionData() {
            const debugOutput = document.getElementById('debugOutput');
            const sessionData = localStorage.getItem(SESSION_KEY);
            
            if (sessionData) {
                debugOutput.innerHTML = `
                    <h4>ä¼šè¯æ•°æ®å†…å®¹:</h4>
                    <div class="code">${JSON.stringify(JSON.parse(sessionData), null, 2)}</div>
                `;
            } else {
                debugOutput.innerHTML = '<div class="status error">âŒ æ— ä¼šè¯æ•°æ®</div>';
            }
        }

        function clearSessionData() {
            localStorage.removeItem(SESSION_KEY);
            document.getElementById('debugOutput').innerHTML = '<div class="status success">âœ… ä¼šè¯æ•°æ®å·²æ¸…é™¤</div>';
        }

        function createTestData() {
            const testSession = {
                id: SHARE_ID,
                hostId: "demo-host-" + Date.now(),
                title: "éš”ç¦»æŸ¥çœ‹å™¨æµ‹è¯•ä¼šè¯",
                createdAt: Date.now() - 3600000, // 1å°æ—¶å‰åˆ›å»º
                lastUpdate: Date.now(),
                canvasState: {
                    blocks: [
                        {
                            id: "test-block-1",
                            type: "text",
                            x: 100,
                            y: 100,
                            width: 300,
                            height: 80,
                            content: "ğŸ§ª è¿™æ˜¯éš”ç¦»æŸ¥çœ‹å™¨æµ‹è¯•å†…å®¹",
                            number: 1
                        },
                        {
                            id: "test-block-2",
                            type: "text",
                            x: 100,
                            y: 200,
                            width: 400,
                            height: 120,
                            content: "âœ… å¦‚æœä½ èƒ½çœ‹åˆ°è¿™ä¸ªå†…å®¹ï¼Œè¯´æ˜éš”ç¦»æŸ¥çœ‹å™¨å·¥ä½œæ­£å¸¸ï¼\\n\\nç‰¹ç‚¹ï¼š\\nâ€¢ å®Œå…¨ç‹¬ç«‹äºRealtimeShareService\\nâ€¢ ç›´æ¥ä»localStorageè¯»å–æ•°æ®\\nâ€¢ ä¿æŒåŸæœ‰ä¸»åº”ç”¨æ ·å¼\\nâ€¢ é¿å…å¤æ‚çš„è¿æ¥é€»è¾‘",
                            number: 2
                        },
                        {
                            id: "test-block-3",
                            type: "image",
                            x: 550,
                            y: 100,
                            width: 200,
                            height: 150,
                            content: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuaXoOWbvueJh+WNoOS9jeespzwvdGV4dD48L3N2Zz4=",
                            number: 3
                        }
                    ],
                    connections: [],
                    zoom: 1,
                    pan: { x: 0, y: 0 }
                },
                viewers: [],
                isActive: true
            };

            localStorage.setItem(SESSION_KEY, JSON.stringify(testSession));
            document.getElementById('debugOutput').innerHTML = '<div class="status success">âœ… æµ‹è¯•æ•°æ®å·²åˆ›å»º</div>';
        }

        function recordSuccess() {
            const results = document.getElementById('testResults');
            results.innerHTML = `
                <div class="status success">
                    âœ… <strong>æµ‹è¯•æˆåŠŸï¼</strong><br>
                    æ—¶é—´: ${new Date().toLocaleString()}<br>
                    ç»“æœ: éš”ç¦»æŸ¥çœ‹å™¨æ­£å¸¸å·¥ä½œï¼Œæ— ç™½å±ï¼Œæ— å´©æºƒ<br>
                    å»ºè®®: å¯ä»¥å°†æ­¤æ–¹æ¡ˆä½œä¸ºé—®é¢˜åˆ†äº«IDçš„è§£å†³æ–¹æ¡ˆ
                </div>
            `;
        }

        function recordFailure() {
            const results = document.getElementById('testResults');
            results.innerHTML = `
                <div class="status error">
                    âŒ <strong>æµ‹è¯•å¤±è´¥</strong><br>
                    æ—¶é—´: ${new Date().toLocaleString()}<br>
                    è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ï¼Œå¹¶è€ƒè™‘å…¶ä»–è§£å†³æ–¹æ¡ˆ
                </div>
            `;
        }

        function clearResults() {
            const results = document.getElementById('testResults');
            results.innerHTML = `
                <div class="status info">
                    æµ‹è¯•ç»“æœå·²æ¸…é™¤ï¼Œè¯·é‡æ–°æ‰§è¡Œæµ‹è¯•
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥æ•°æ®
        window.onload = function() {
            console.log('éš”ç¦»æŸ¥çœ‹å™¨æµ‹è¯•å·¥å…·å·²åŠ è½½');
            
            // è‡ªåŠ¨æ£€æŸ¥ä¼šè¯æ•°æ®
            setTimeout(checkSessionData, 500);
        };
    </script>
</body>
</html>